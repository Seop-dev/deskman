import{$ as P,a6 as Y,O as C,y as h,_ as q,P as L,q as O,o as $,a,w as s,V as D,b as i,a0 as m,a2 as B,aT as j,e as I,a3 as G,a4 as T,f as H,F as K,H as z}from"./index-CGGVM91c.js";import{_ as J,a as Q}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{u as W}from"./auth-B63OrgMx.js";import{d as X}from"./theme-bootstrap-maRaUoWN.js";const oe={__name:"EquipmentRegistration",setup(Z){var N;const p=X.useToast(),E=W(),w=z(),g=P.create({baseURL:"http://localhost:3000",headers:{"Content-Type":"application/json"}}),y={nextId:"/facility/next-id",codesFC:"/common/codes/FC",insert:"/facilityInsert",list:"/facility"},b=async(o,e,l=null)=>{var n;try{return await g.request({method:o,url:"/api"+e,data:l})}catch(u){if(((n=u==null?void 0:u.response)==null?void 0:n.status)===404)return await g.request({method:o,url:e,data:l});throw u}},t=Y({code:"",name:"",type:"",useYn:"사용",maker:"",makeDate:"",installDate:"",checkCycle:"",manager:((N=E.user)==null?void 0:N.name)||""}),A=C([]),f=C(!1),F=h(()=>!!t.name&&!!t.type),c=o=>o===""||o===void 0?null:o,U=o=>{if(o===""||o===null||o===void 0)return null;const e=Number(o);return Number.isFinite(e)?e:null},S=o=>String(o).padStart(3,"0"),R=o=>{const e=String(o??"").match(/\d+/),l=Number(e==null?void 0:e[0]);return Number.isFinite(l)?`PRC-${S(l)}`:null};q(async()=>{var o,e,l;try{const[n,u]=await Promise.all([b("get",y.nextId),b("get",y.codesFC)]);t.code=((o=n==null?void 0:n.data)==null?void 0:o.FAC_ID)||"";const V=Array.isArray(u==null?void 0:u.data)?u.data:[];A.value=V.sort((r,d)=>{const _=Number.isFinite(Number(r==null?void 0:r.sort_order))?Number(r.sort_order):9999,k=Number.isFinite(Number(d==null?void 0:d.sort_order))?Number(d.sort_order):9999;return _!==k?_-k:String((r==null?void 0:r.code_name)||"").localeCompare(String((d==null?void 0:d.code_name)||""))})}catch(n){console.error(n),p.error("초기 로딩 실패: "+(((l=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:l.error)||(n==null?void 0:n.message)),{position:"top-right",duration:1e3})}});const x=async()=>{var l,n,u,V;if(!F.value){p.error("(설비명/설비유형)을 확인하세요.",{position:"top-right",duration:1e3});return}const o=R(t.type);if(!o){p.error("공정(PR_ID) 매핑 실패: 설비유형을 다시 선택하세요.",{position:"top-right",duration:1e3});return}const e={FAC_NAME:c(t.name),FAC_TYPE:c(t.type),FAC_USE:t.useYn==="사용"?1:0,FAC_COMPANY:c(t.maker),FAC_MDATE:c(t.makeDate),FAC_IDATE:c(t.installDate),FAC_CHECKDAY:U(t.checkCycle),PR_ID:o,MANAGER:c(t.manager)};try{f.value=!0;const r=await b("post",y.insert,e),d=(l=r==null?void 0:r.data)==null?void 0:l.FAC_ID;if(!d)throw new Error(((n=r==null?void 0:r.data)==null?void 0:n.error)||"등록 실패");t.code=d,p.success("설비 등록 완료!",{position:"top-right",duration:1e3}),w.push({path:"/utils/List",query:{proc:o}})}catch(r){console.error(r),p.error(((V=(u=r==null?void 0:r.response)==null?void 0:u.data)==null?void 0:V.error)||(r==null?void 0:r.message)||"등록 실패",{position:"top-right",duration:1e3})}finally{f.value=!1}},M=C({title:"설비 정보 관리"}),v=L([{title:"설비",disabled:!0,href:"#"},{title:"설비 등록",disabled:!1,href:"#"}]);return(o,e)=>($(),O(K,null,[a(J,{title:M.value.title,breadcrumbs:v.value},null,8,["title","breadcrumbs"]),a(Q,{title:"설비 등록"},{default:s(()=>[a(D,{class:"mb-4"},{default:s(()=>[a(i,{cols:"6"},{default:s(()=>[a(m,{label:"설비코드",modelValue:t.code,"onUpdate:modelValue":e[0]||(e[0]=l=>t.code=l),modelModifiers:{trim:!0},dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"설비명",modelValue:t.name,"onUpdate:modelValue":e[1]||(e[1]=l=>t.name=l),modelModifiers:{trim:!0},dense:"",outlined:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(B,{label:"설비유형",modelValue:t.type,"onUpdate:modelValue":e[2]||(e[2]=l=>t.type=l),items:A.value,"item-title":"code_name","item-value":"code",dense:"",outlined:"",clearable:"",placeholder:"유형 선택"},null,8,["modelValue","items"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"제조사",modelValue:t.maker,"onUpdate:modelValue":e[3]||(e[3]=l=>t.maker=l),modelModifiers:{trim:!0},dense:"",outlined:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"12"},{default:s(()=>[a(j,{class:"mb-2 d-block"},{default:s(()=>e[9]||(e[9]=[I("사용유무")])),_:1}),a(G,{modelValue:t.useYn,"onUpdate:modelValue":e[4]||(e[4]=l=>t.useYn=l),inline:""},{default:s(()=>[a(T,{label:"사용",value:"사용"}),a(T,{label:"정지",value:"정지"})]),_:1},8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"설비 제조일",modelValue:t.makeDate,"onUpdate:modelValue":e[5]||(e[5]=l=>t.makeDate=l),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"설비 설치일",modelValue:t.installDate,"onUpdate:modelValue":e[6]||(e[6]=l=>t.installDate=l),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"점검 주기(일)",modelValue:t.checkCycle,"onUpdate:modelValue":e[7]||(e[7]=l=>t.checkCycle=l),modelModifiers:{number:!0},type:"number",min:"0",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"담당자",modelValue:t.manager,"onUpdate:modelValue":e[8]||(e[8]=l=>t.manager=l),modelModifiers:{trim:!0},dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(D,{justify:"end"},{default:s(()=>[a(H,{color:"primary",onClick:x,loading:f.value,disabled:f.value||!F.value},{default:s(()=>e[10]||(e[10]=[I("등록")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})],64))}};export{oe as default};
