import{_ as q,a as P}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{B as D}from"./main-Dfa23GB-.js";import{O as t,P as U,_ as z,$ as w,q as G,o as Y,a as r,w as u,d as n,A as k,V as N,f as R,e as g,t as H,a8 as J,F as K}from"./index-CGGVM91c.js";import{_ as L}from"./NewModal-RG6-e5WE.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"main-container"},X={class:"list-container"},Z={__name:"MkAccount",setup(ee){const C=t({title:"거래처등록 및 조회"}),_=U([{title:"거래처",disabled:!0,href:"#"},{title:"거래처등록 및 조회",disabled:!1,href:"#"}]),i=t({open:!1,msg:"",color:"primary"}),s=(e,l="primary")=>i.value={open:!0,msg:e,color:l},V={rowSelection:"multiple",suppressRowClickSelection:!0},f=t(null);function S(e){f.value=e.api}function A(e){console.log("행 선택됨:",e.data)}const d=t([{거래처유형:null,거래처명:null,담당자:null,사용여부:null,비고:null}]),m=t(null),B=[{field:"거래처유형",headerName:"거래처유형",flex:1}],M=t([{거래처유형:"고객사"},{거래처유형:"공급사"},{거래처유형:"외주업체"},{거래처유형:"운송업체"},{거래처유형:"폐기업체"}]),E=t([{field:"거래처유형",headerName:"거래처유형",flex:1,cellClass:"clickable-cell",editable:!1,onCellClicked:e=>{m.value=e.node.rowIndex,I("거래처유형",M.value,B)}},{field:"거래처명",flex:1,editable:!0},{field:"담당자",flex:1,editable:!0},{field:"사용여부",headerName:"사용여부",flex:1,editable:!0,cellEditor:"agSelectCellEditor",cellEditorParams:{values:["사용","미사용"]}},{field:"비고",flex:1,editable:!0}]),p=t(null),x=t(""),b=t([]),h=t([]);function I(e,l,a){var o,c;x.value=e,b.value=l,h.value=a,(c=(o=p.value)==null?void 0:o.open)==null||c.call(o)}function F(e){var a,o;if(m.value==null)return;const l=m.value;d.value=d.value.map((c,j)=>j===l?{...c,거래처유형:e.거래처유형}:c),(o=(a=p.value)==null?void 0:a.close)==null||o.call(a)}const O=async()=>{const e=d.value[0];if(!e.거래처유형||!e.거래처명||!e.담당자||!e.사용여부)return s("비어있는 항목이 존재합니다.","warning");if(!(e.사용여부==="사용"||e.사용여부==="미사용"))return s("사용/미사용 확인","warning");if(!confirm("등록하시겠습니까?"))return;const l={cusType:e.거래처유형,cusName:e.거래처명,cusManager:e.담당자,cusUse:e.사용여부==="사용"?1:0,cusNote:e.비고};console.log(l);try{const{data:a}=await w.post("http://localhost:3000/marketing/insertacc",l);a.affectedRows>0?(await v(),s("성공적으로 등록되었습니다.","success"),Object.keys(e).forEach(o=>e[o]="")):s("데이터 등록 실패","error")}catch(a){console.error(a),s("오류가 발생하였습니다.","error")}},y=t([]),T=t([{headerName:"",checkboxSelection:!0,headerCheckboxSelection:!0,width:50},{headerName:"거래처코드",field:"cusId",flex:1},{headerName:"거래처유형",field:"cusType",flex:1},{headerName:"거래처명",field:"cusName",flex:1},{headerName:"담당자",field:"cusManager",flex:1},{headerName:"사용여부",field:"cusUse",flex:1,valueFormatter:e=>e.value==="Y"||e.value===1||e.value==="1"?"사용":"미사용"},{headerName:"비고",field:"cusNote",flex:1}]);z(()=>v());async function v(){const e=await w.get("http://localhost:3000/marketing/getacclist");console.log("서버 응답:",e.data),y.value=Array.isArray(e.data)?e.data:e.data.data??[]}const $=async()=>{if(!f.value)return s("그리드가 준비되지 않았습니다.","warning");const e=f.value.getSelectedRows();if(!e.length)return s("삭제할 항목을 선택하세요.","warning");try{const l=e.map(o=>o.cusId),{data:a}=await w.delete("http://localhost:3000/deleteAccount",{data:{ids:l}});console.log(a),a.affectedRows>0?(await v(),s("성공적으로 삭제되었습니다.","success")):s("데이터 삭제 실패","error")}catch(l){console.error(l),s("오류가 발생하였습니다.","error")}};return(e,l)=>(Y(),G(K,null,[r(q,{title:C.value.title,breadcrumbs:_.value},null,8,["title","breadcrumbs"]),r(P,{title:"거래처등록 및 조회"},{default:u(()=>[n("div",W,[n("div",X,[l[3]||(l[3]=n("h5",null,"거래처등록",-1)),r(k(D),{rowData:d.value,columnDefs:E.value,class:"ag-theme-quartz",style:{height:"90px",width:"100%"}},null,8,["rowData","columnDefs"]),l[4]||(l[4]=n("br",null,null,-1)),l[5]||(l[5]=n("br",null,null,-1)),r(N,{justify:"end"},{default:u(()=>[r(R,{color:"primary",class:"mr-6",onClick:O},{default:u(()=>l[1]||(l[1]=[g("등록")])),_:1})]),_:1}),l[6]||(l[6]=n("h5",null,"거래처목록",-1)),r(k(D),{class:"ag-theme-quartz",rowData:y.value,columnDefs:T.value,gridOptions:V,style:{height:"360px",width:"100%"},onGridReady:S,onRowClicked:A},null,8,["rowData","columnDefs"]),l[7]||(l[7]=n("br",null,null,-1)),l[8]||(l[8]=n("br",null,null,-1)),r(N,{justify:"end"},{default:u(()=>[r(R,{color:"error",class:"mr-6",onClick:$},{default:u(()=>l[2]||(l[2]=[g("삭제")])),_:1})]),_:1})]),r(L,{ref_key:"modalRef",ref:p,title:x.value,rowData:b.value,colDefs:h.value,onConfirm:F},null,8,["title","rowData","colDefs"])])]),_:1}),r(J,{modelValue:i.value.open,"onUpdate:modelValue":l[0]||(l[0]=a=>i.value.open=a),color:i.value.color,timeout:2e3},{default:u(()=>[g(H(i.value.msg),1)]),_:1},8,["modelValue","color"])],64))}},re=Q(Z,[["__scopeId","data-v-61fde704"]]);export{re as default};
