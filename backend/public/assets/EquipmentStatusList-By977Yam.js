import{_ as U,a as X}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{B as j}from"./main-Dfa23GB-.js";import{aU as Q,aV as J,O as r,P as Z,q as ee,o as te,a as s,w as i,V as T,b as x,f as ae,e as oe,a0 as le,A as R,a1 as se,F as re,$ as u}from"./index-CGGVM91c.js";import{d as v}from"./dayjs.min-BPYrWRgr.js";import{_ as ie}from"./NewModal-RG6-e5WE.js";import{d as ne}from"./theme-bootstrap-maRaUoWN.js";const f="http://localhost:3000",Ce={__name:"EquipmentStatusList",setup(ce){const d=ne.useToast();Q.registerModules([J]);const w=se,h=`${f}/process`;let _=new Map;const M=async()=>{const{data:e}=await u.get(`${f}/common/codes/FC`),a=new Map;for(const l of e||[])a.set(l.code??l.CODE,l.code_name??l.CODE_NAME);_=a},n=r(""),b={editable:!1,sortable:!0,resizable:!0},c=r(null),N=async e=>{c.value=e.api,await I()},C=e=>{c.value&&(c.value.setFilterModel({공정코드:{filterType:"text",type:"equals",filter:e||""}}),c.value.onFilterChanged())},P=e=>({0:"가동",1:"비가동",2:"점검중"})[Number(e)]??String(e),S=e=>e==="가동"?{color:"blue",fontWeight:"bold"}:e==="비가동"?{color:"red",fontWeight:"bold"}:null,A=e=>e?v(e).format("YYYY-MM-DD"):"",Y=r([{field:"공정코드",hide:!0,filter:"agTextColumnFilter"},{field:"설비코드",flex:1},{field:"설비명",flex:1},{field:"설비유형",flex:1},{field:"설비상태",flex:1,cellStyle:e=>S(e.value)},{field:"비가동사유",flex:1},{field:"점검완료일",flex:1},{field:"다음점검일",flex:1},{field:"담당자",flex:1}]),m=r([]),V=async()=>{const{data:e}=await u.get(`${f}/facility`);return e||[]},$=async()=>{try{const{data:e}=await u.get(`${f}/facility/status`);return e||[]}catch(e){return console.error(e),d.error("설비 상태 조회 실패",{position:"top-right",duration:1e3}),[]}},D=e=>new Date(e.FS_CHECKDAY||e.DOWN_ENDDAY||e.DOWN_STARTDAY||0).getTime(),O=(e,a)=>{const l=new Map;for(const o of a||[]){const t=l.get(o.FAC_ID);(!t||D(o)>=D(t))&&l.set(o.FAC_ID,o)}return(e||[]).map(o=>{const t=l.get(o.FAC_ID),p=t?Number(t.FS_STATUS):0,K=P(p);let F="-";p===2&&(F=t!=null&&t.FS_CHECKDAY?A(t.FS_CHECKDAY):"-");const L=o.FAC_TYPE_NM??(o.FAC_TYPE?_.get(String(o.FAC_TYPE))||o.FAC_TYPE:"-");return{공정코드:o.PR_ID||"",설비코드:o.FAC_ID,설비명:o.FAC_NAME||"",설비유형:L,설비상태:K,비가동사유:p===1&&(t==null?void 0:t.FS_REASON)||"-",점검완료일:F,다음점검일:t!=null&&t.FS_NEXTDAY?A(t.FS_NEXTDAY):"-",담당자:o.MANAGER&&o.MANAGER!=="-"?o.MANAGER:(t==null?void 0:t.MANAGER)||"-"}})},I=async()=>{try{await M();const[e,a]=await Promise.all([V(),$()]);m.value=O(e,a),n.value&&C(n.value)}catch(e){console.error(e),m.value=[],d.error("초기 로딩 실패",{position:"top-right",duration:1e3})}},y=r(null),E=r(""),g=r([]),B=r([{field:"공정코드",flex:1},{field:"공정명",flex:1},{field:"설비유형",flex:1},{field:"등록일자",flex:1},{field:"작성자",flex:1},{field:"비고",flex:1}]),G=e=>({공정코드:e.PR_ID??e.PRC_CODE??"",공정명:e.PRC_NAME??"",설비유형:e.FAC_TYPE??"",등록일자:e.PRC_RDATE?v(e.PRC_RDATE).format("YYYY-MM-DD"):"",작성자:e.PRC_WRITER??"",비고:e.PRC_NOTE??""}),W=async()=>{const{data:e}=await u.get(h);return(Array.isArray(e)?e:[]).map(G)},k=async e=>{var a;try{E.value=e,g.value=await W(),(a=y.value)==null||a.open()}catch(l){console.error("[process list] error:",l),d.error("공정 목록 조회 실패",{position:"top-right",duration:1e3})}},q=e=>{e&&(n.value=e.공정코드||"",C(e.공정코드))},z=r({title:"설비 상태 관리"}),H=Z([{title:"설비",disabled:!0,href:"#"},{title:"전체 조회",disabled:!1,href:"#"}]);return(e,a)=>(te(),ee(re,null,[s(U,{title:z.value.title,breadcrumbs:H.value},null,8,["title","breadcrumbs"]),s(X,{title:"전체 조회"},{default:i(()=>[s(T,{class:"mb-2 py-0"},{default:i(()=>[s(x,{cols:"12",class:"d-flex align-center"},{default:i(()=>[s(ae,{color:"warning",variant:"flat",onClick:a[0]||(a[0]=l=>k("공정 조회"))},{default:i(()=>a[2]||(a[2]=[oe("공정 조회")])),_:1})]),_:1})]),_:1}),s(T,{class:"mb-4 pt-0"},{default:i(()=>[s(x,{cols:"12",md:"3"},{default:i(()=>[s(le,{label:"공정코드",modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=l=>n.value=l),readonly:"","hide-details":"",density:"comfortable",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),s(R(j),{style:{height:"420px"},theme:R(w),rowData:m.value,columnDefs:Y.value,defaultColDef:b,animateRows:!0,suppressClickEdit:!0,pagination:!0,"pagination-page-size":10,onGridReady:N},null,8,["theme","rowData","columnDefs"])]),_:1}),s(ie,{ref_key:"modalRef",ref:y,title:E.value,rowData:g.value,colDefs:B.value,onConfirm:q},null,8,["title","rowData","colDefs"])],64))}};export{Ce as default};
