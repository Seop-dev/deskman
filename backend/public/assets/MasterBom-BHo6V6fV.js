import{_ as te,a as le}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{O as s,P as ae,_ as re,$ as d,q as se,o as ne,a as l,w as i,d as u,a0 as f,f as p,e as v,A as M,a1 as ie,V,b as C,F as ue}from"./index-CGGVM91c.js";import{B as x}from"./main-Dfa23GB-.js";import{_ as de}from"./NewModal-RG6-e5WE.js";import{u as ce}from"./auth-B63OrgMx.js";import{d as me}from"./theme-bootstrap-maRaUoWN.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"d-flex align-center mb-4"},ve={class:"main-container"},Me={class:"list-container"},he={class:"d-flex align-center mb-2"},De={class:"form-wrapper"},be={class:"add"},_e={class:"btn-list"},ge={__name:"MasterBom",setup(Oe){var k;const w=ie,I=new Date().toISOString().split("T")[0],B=ce(),a=s({writer:((k=B.user)==null?void 0:k.name)||"",addDate:I,bomVer:"",bomCode:"",prdName:""}),r=me.useToast(),h=s([]),U=s([{field:"제품명",flex:1},{field:"제품코드",flex:1},{field:"제품유형",flex:1},{field:"작성자",flex:1},{field:"등록일",flex:1}]),D=s([]),Y=s([{field:"BOM코드",editable:!0,flex:1},{field:"제품명",flex:1},{field:"BOM버젼",flex:1},{field:"작성자",flex:1},{field:"사용유무",flex:1},{field:"등록일",flex:1}]),c=s([]),F=s([{headerCheckboxSelection:!0,checkboxSelection:!0,width:50},{field:"자재코드",editable:!0,flex:1},{field:"자재명",flex:1},{field:"자재유형",flex:1},{field:"소요수량",flex:1,editable:!0,cellEditor:"agNumberCellEditor",cellEditorParams:{inputType:"number",min:0,step:1}},{field:"단위",flex:1,editable:!0}]),$=s({title:"BOM관리"}),W=ae([{title:"기준정보",disabled:!0,href:"#"},{title:"BOM 관리",disabled:!1,href:"#"}]),T=async()=>{try{const o=await d.get("http://localhost:3000/BOMprdSelect");h.value=o.data.map(e=>({제품명:e.PRD_NAME,제품코드:e.PRD_CODE,제품유형:e.PRD_TYPE,작성자:e.PRD_WRITER,등록일:e.PRD_DATE.substring(0,10)}))}catch(o){console.error("제품 목록을 불러오는 중 오류가 발생했습니다:",o),r.error("제품 목록을 불러올 수 없습니다.",{position:"top-right",duration:1e3})}},_=async()=>{const o={BOM_CODE:a.value.bomCode,BOM_VER:a.value.bomVer};try{const e=await d.post("http://localhost:3000/BOM_detailSelect",o);c.value=e.data.map(t=>({자재코드:t.MAT_CODE,자재명:t.MAT_NAME,자재유형:t.MAT_TYPE,소요수량:t.QTY,단위:t.UNIT}))}catch(e){console.error("자재 목록을 불러오는 중 오류가 발생했습니다:",e),r.error("자재 목록을 불러올 수 없습니다.",{position:"top-right",duration:1e3})}};re(()=>{T(),X()});const E=o=>{console.log(o.value),console.log(h.value)},b=s(""),L=async()=>{if(!b.value){r.warning("제품이 입력되지 않았습니다",{position:"top-right",duration:1e3});return}const o={PRD_NAME:b.value};try{const e=await d.post("http://localhost:3000/bomSearch",o);h.value=e.data.map(t=>({제품명:t.PRD_NAME,제품코드:t.PRD_CODE,제품유형:t.PRD_TYPE,작성자:t.PRD_WRITER,등록일:t.PRD_DATE.substring(0,10)})),console.log("검색 키워드:",b.value),console.log(h.value),D.value=[],c.value=[],r.success("검색이 완료되었습니다.",{position:"top-right",duration:1e3})}catch(e){console.error("검색 중 오류가 발생했습니다:",e),r.error("검색에 실패했습니다.",{position:"top-right",duration:1e3})}},q=()=>{var o;a.value={writer:((o=B.user)==null?void 0:o.name)||"",addDate:""},D.value=[],c.value=[],T()},g=s(null),O=s(null),j=async o=>{try{const e=await d.post("http://localhost:3000/BOMbomSelect",o);D.value=e.data.map(t=>({BOM코드:t.BOM_CODE,제품명:t.PRD_NAME,BOM버젼:t.BOM_VER,작성자:t.BOM_WRITER,사용유무:t.USE_YN,등록일:t.BOM_RDATE.substring(0,10)}))}catch(e){console.error("BOM 목록을 불러오는 중 오류가 발생했습니다:",e),r.error("BOM 목록을 불러올 수 없습니다.",{position:"top-right",duration:1e3})}},z=async o=>{var t;a.value.prdName=o.data.제품명;const e={PRD_CODE:o.data.제품코드};try{const n=await d.post("http://localhost:3000/BOMbomSelect",e);D.value=n.data.map(m=>({BOM코드:m.BOM_CODE,제품명:m.PRD_NAME,BOM버젼:m.BOM_VER,작성자:m.BOM_WRITER,사용유무:m.USE_YN,등록일:m.BOM_RDATE.substring(0,10)})),g.value=o.data,O.value=(t=n.data[0])==null?void 0:t.BOM_VER}catch(n){console.error("BOM 목록을 불러오는 중 오류가 발생했습니다:",n),r.error("BOM 목록을 불러올 수 없습니다.",{position:"top-right",duration:1e3})}},G=async()=>{var e;if(!a.value.prdName){r.error("제품을 선택해주세요.",{position:"top-right",duration:1e3});return}console.log(g.value);const o={PRD_CODE:g.value.제품코드,BOM_WRITER:((e=B.user)==null?void 0:e.name)||"",BOM_VER:O.value?O.value:"v1.01"};console.log(O.value);try{const t=await d.post("http://localhost:3000/BOMinsert",o);console.log(t);const n={PRD_CODE:g.value.제품코드};await j(n),r.success("BOM이 성공적으로 추가되었습니다!",{position:"top-right",duration:1e3})}catch(t){console.error("BOM 추가 중 오류가 발생했습니다:",t),r.error("BOM 추가에 실패했습니다.",{position:"top-right",duration:1e3})}},Q=async o=>{a.value.bomCode=o.data.BOM코드,a.value.bomVer=o.data.BOM버젼,a.value.writer=o.data.작성자,a.value.addDate=o.data.등록일,await _()},R=s(null),Z=o=>{R.value=o.api},K=async()=>{const o=R.value.getSelectedRows();if(!o.length){r.warning("수정할 자재를 선택해주세요.",{position:"top-right",duration:1e3});return}const e=o.map(n=>n.자재코드),t=o.map(n=>n.소요수량);try{await d.post("http://localhost:3000/bomMatUpdate",{bomCode:a.value.bomCode,matCodes:e,qtys:t}),r.success("저장이 완료되었습니다.",{position:"top-right",duration:1e3}),await _()}catch(n){console.error("저장 중 오류가 발생했습니다:",n),r.error("저장에 실패했습니다.",{position:"top-right",duration:1e3})}},H=async()=>{const o=R.value.getSelectedRows();if(o.length===0){r.warning("삭제할 자재를 선택하세요.");return}const e={BOM_CODE:a.value.bomCode,MAT_CODE:o[0].자재코드};console.log(e);try{await d.post("http://localhost:3000/bomDelete",e),r.success("삭제가 완료되었습니다.",{position:"top-right",duration:1e3}),await _()}catch(t){console.error("삭제 중 오류가 발생했습니다:",t),r.error("삭제에 실패했습니다.",{position:"top-right",duration:1e3})}},y=s(null),A=s(""),N=s([]),P=s([]),J=[{field:"자재코드",headerName:"자재코드",flex:1},{field:"자재명",headerName:"자재명",flex:1},{field:"자재유형",headerName:"자재유형",flex:1},{field:"규격",headerName:"규격",flex:1,editable:!0},{field:"단위",headerName:"단위",flex:1,editable:!0}],S=s([]),X=async()=>{try{const o=await d.get("http://localhost:3000/BOMmodalSelect");S.value=o.data.map(e=>({자재코드:e.MAT_CODE,자재명:e.MAT_NAME,자재유형:e.MAT_TYPE,규격:e.MAT_SIZE,단위:e.MAT_UNIT}))}catch(o){console.error("모달 자재 목록을 불러오는 중 오류가 발생했습니다:",o),r.error("자재 목록을 불러올 수 없습니다.",{position:"top-right",duration:1e3})}},ee=async(o,e,t)=>{if(!a.value.bomCode){r.warning("BOM이 선택되지 않았습니다.",{position:"top-right",duration:1e3});return}A.value=o,N.value=e,P.value=t,y.value&&y.value.open()},oe=async o=>{const e={BOM_CODE:a.value.bomCode,MAT_CODE:o.자재코드,MAT_NAME:o.자재명,MAT_TYPE:o.자재유형,MAT_SIZE:o.규격,UNIT:o.단위,BOM_VER:a.value.bomVer};try{for(var t=0;t<c.value.length;t++)if(o.자재코드==c.value[t].자재코드){r.info("아미 등록된 자재입니다.",{position:"top-right",duration:1e3});return}const n=await d.post("http://localhost:3000/BOMmodalConfirm",e);console.log(n),r.success("자재가 성공적으로 추가되었습니다!",{position:"top-right",duration:1e3}),await _()}catch(n){console.error("자재 추가 중 오류가 발생했습니다:",n),r.error("자재 추가에 실패했습니다.",{position:"top-right",duration:1e3})}};return(o,e)=>(ne(),se(ue,null,[l(te,{title:$.value.title,breadcrumbs:W.value},null,8,["title","breadcrumbs"]),l(le,{title:"제품 목록"},{default:i(()=>[u("div",pe,[l(f,{label:"제품명 검색",modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=t=>b.value=t),"hide-details":"",class:"mr-2",style:{"max-width":"280px"}},null,8,["modelValue"]),l(p,{color:"darkText",onClick:L},{default:i(()=>e[7]||(e[7]=[v("검색")])),_:1})]),u("div",ve,[u("div",Me,[l(M(x),{rowData:h.value,columnDefs:U.value,theme:M(w),style:{height:"200px",width:"100%"},onCellValueChanged:E,onRowClicked:z},null,8,["rowData","columnDefs","theme"]),e[11]||(e[11]=u("br",null,null,-1)),e[12]||(e[12]=u("br",null,null,-1)),u("div",he,[e[10]||(e[10]=u("h5",{class:"mb-0 mr-3"},"BOM목록",-1)),l(f,{label:"제품명",modelValue:a.value.prdName,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.prdName=t),"hide-details":"",readonly:"true",style:{"max-width":"150px"}},null,8,["modelValue"]),l(V,{justify:"end"},{default:i(()=>[l(p,{color:"error",class:"mr-3",onClick:q},{default:i(()=>e[8]||(e[8]=[v("초기화")])),_:1}),l(p,{color:"primary",class:"mr-6",onClick:G},{default:i(()=>e[9]||(e[9]=[v("추가")])),_:1})]),_:1})]),l(M(x),{rowData:D.value,columnDefs:Y.value,theme:M(w),style:{height:"200px",width:"100%"},onCellValueChanged:E,onRowClicked:Q},null,8,["rowData","columnDefs","theme"])]),u("div",De,[u("div",be,[l(V,{class:"mb-4"},{default:i(()=>[l(C,{cols:"6"},{default:i(()=>[l(f,{label:"BOM코드",modelValue:a.value.bomCode,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.bomCode=t),readonly:!0,dense:"",outlined:""},null,8,["modelValue"])]),_:1}),l(C,{cols:"6"},{default:i(()=>[l(f,{label:"BOM버젼",modelValue:a.value.bomVer,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.bomVer=t),readonly:!0,dense:"",outlined:""},null,8,["modelValue"])]),_:1}),l(C,{cols:"6"},{default:i(()=>[l(f,{label:"작성자",modelValue:a.value.writer,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.writer=t),readonly:!0,outlined:""},null,8,["modelValue"])]),_:1}),l(C,{cols:"6"},{default:i(()=>[l(f,{label:"등록일자",modelValue:a.value.addDate,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.addDate=t),type:"date",dense:"",outlined:"",style:{"margin-bottom":"13px"}},null,8,["modelValue"])]),_:1})]),_:1})]),e[16]||(e[16]=u("br",null,null,-1)),e[17]||(e[17]=u("h5",{class:"mb-0 mr-3"},"자재목록",-1)),u("div",_e,[l(V,{justify:"end"},{default:i(()=>[l(p,{color:"warning",class:"mr-4",onClick:e[6]||(e[6]=t=>ee("자재 조회",S.value,J)),style:{"margin-bottom":"2rem"}},{default:i(()=>e[13]||(e[13]=[v("자재 조회 ")])),_:1}),l(p,{color:"primary",class:"mr-3",onClick:K},{default:i(()=>e[14]||(e[14]=[v("저장")])),_:1}),l(p,{color:"error",class:"mr-4",onClick:H},{default:i(()=>e[15]||(e[15]=[v("삭제")])),_:1})]),_:1}),l(de,{ref_key:"modalRef",ref:y,title:A.value,rowData:N.value,colDefs:P.value,onConfirm:oe},null,8,["title","rowData","colDefs"]),l(M(x),{rowData:c.value,columnDefs:F.value,theme:M(w),style:{height:"200px",width:"100%"},onCellValueChanged:E,rowSelection:"multiple",onGridReady:Z,enableCellChangeFlash:"true"},null,8,["rowData","columnDefs","theme"])])])])]),_:1})],64))}},xe=fe(ge,[["__scopeId","data-v-ac3be843"]]);export{xe as default};
