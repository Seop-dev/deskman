import{aU as $,aY as j,aZ as K,O as o,P as L,y as U,_ as J,a_ as Z,q as X,o as ee,a as l,w as i,a$ as te,V as R,b as T,f as O,e as _,A as f,a1 as ae,d as w,j as le,t as S,b0 as oe,W as ie,S as se,T as re,aH as ne,F as de,$ as h,H as ue}from"./index-CGGVM91c.js";import{_ as ce,a as me}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{B as x}from"./main-Dfa23GB-.js";import{d as fe}from"./theme-bootstrap-maRaUoWN.js";import{u as he}from"./auth-B63OrgMx.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"d-flex align-center"},ge={class:"ml-auto text-caption"},Ce={__name:"MaterialManagement",setup(_e){const p=fe.useToast(),v=he();$.registerModules([j,K]);const D=ae,r=Z(),y=ue(),V=o({title:"원자재 검수관리 등록"}),M=o([{title:"품질",disabled:!0,href:"#"},{title:"원자재 검수관리 등록",disabled:!1,href:"#"}]),A=o([{_id:"moisture",label:"함수율",allow:"수분 함량 12~15% (KS범위)"},{_id:"appearance",label:"외관결점",allow:"옹이≤150mm, 활결≤50%, 전체길이 1% 이내"},{_id:"thickness",label:"치수정밀도",allow:"입고자재 ±2mm 이내"},{_id:"strength",label:"강도",allow:"KS F 2207, 횡강도 ≥ 35MPa"},{_id:"surface",label:"외관/표면 결함",allow:"육안확인 시 결점 없음"}]),g=L(null),N=o({resizable:!0,minWidth:120,sortable:!1}),Q=o({mode:"multiRow"}),I=o({headerName:"판정",pinned:"right",width:90,headerCheckboxSelection:!0,headerCheckboxSelectionCurrentPageOnly:!1,checkboxSelection:!0,suppressHeaderMenuButton:!0}),P=o([{headerName:"검사기준",field:"label",minWidth:160,flex:1},{headerName:"허용수치",field:"allow",minWidth:360,flex:2},{headerName:"판정",colId:"result",minWidth:120,maxWidth:140,valueGetter:e=>{var t;return(t=e.node)!=null&&t.isSelected()?"합격":"불합격"},cellClass:e=>e.value==="합격"?"ag-cell-success":"ag-cell-error",sortable:!1}]),s=o({description:""}),k=o({defaultColDef:N.value,getRowId:e=>e.data._id}),u=o(0),c=o(0),n=U(()=>c.value===u.value?"합격":"불합격");function q(e){g.value=e.api}function B(e){const t=[];e.api.forEachNode(a=>t.push(a)),e.api.setNodesSelected({nodes:t,newValue:!0}),C()}function C(){const e=g.value;e&&(u.value=e.getDisplayedRowCount(),c.value=e.getSelectedNodes().length,e.refreshCells({columns:["result"],force:!0}),c.value===u.value&&(s.value={category:"",severity:"",description:""}))}const m=o([{id:"(자동생성)",inNo:"(자동입력)",materialCode:"(자동입력)",totalQty:"(자동입력)",user:"(세션사용자)",inDate:"(자동입력)",doneDate:"(현재 yyyyMMdd)"}]);function W(e){const t=Number(String(e.newValue).replace(/,/g,"").trim());return Number.isFinite(t)?t:e.oldValue}const F=o([{headerName:"원자재검사번호",field:"id",width:170,editable:!1},{headerName:"입고번호",field:"inNo",width:140,editable:!1},{headerName:"원자재코드",field:"materialCode",width:150,editable:!1},{headerName:"총수량",field:"totalQty",width:110,editable:!0,valueParser:W},{headerName:"작성자",field:"user",width:120,editable:!0},{headerName:"입고일자",field:"inDate",width:140,editable:!0},{headerName:"검사완료일자",field:"doneDate",width:140,editable:!0}]),z=o({defaultColDef:{resizable:!0,minWidth:110},autoSizeStrategy:{type:"fitGridWidth"}});J(()=>{var a;const e=m.value[0];e.inNo=String(r.query.receiptNo||""),e.materialCode=String(r.query.matCode||""),e.materialName=String(r.query.materialName||""),e.totalQty=Number(r.query.totalQty||0),e.inDate=String(r.query.inDate||""),e.user=String(((a=v.user)==null?void 0:a.name)||"");const t=new Date;e.doneDate=t.toISOString().slice(0,10)});function G(){const e=g.value;if(e){const a=[];e.forEachNode(d=>a.push(d)),e.setNodesSelected({nodes:a,newValue:!1}),C()}const t=m.value[0];t.totalQty=0,t.passQty=0,t.user="",t.inDate="",t.doneDate="",s.value={category:"",severity:"",description:""}}async function H(){var b,E;const e=m.value[0],t=n.value==="합격";if(!t&&!s.value.description.trim()){p.warning("불합격 사유를 입력해주세요.",{position:"top-right",duration:1e3});return}const a=new Date,d={RECEIPT_NO:String(e.inNo.trim()),MAT_CODE:String(e.materialCode.trim()),Q_CHECKED_DATE:a.toISOString().slice(0,10),TOTAL_QTY:Number(e.totalQty)||0,CREATED_BY:String(((b=v.user)==null?void 0:b.name)||"")},Y={RECEIPT_NO:String(e.inNo),MAT_CODE:String(e.materialCode),RJT_REASON:String(s.value.description.trim().slice(0,100)),Q_CHECKED_DATE:a.toISOString().slice(0,10),TOTAL_QTY:Number(e.totalQty),CREATED_BY:String(((E=v.user)==null?void 0:E.name)||"")};t?(await h.post("http://localhost:3000/passmat",d),p.info("합격등록이 완료되었습니다.",{position:"top-right",duration:1e3}),await h.post("http://localhost:3000/chmatstatus",{RECEIPT_NO:d.RECEIPT_NO}),y.push("/qm/matlst")):(await h.post("http://localhost:3000/rejectmat",Y),p.info("불합격등록이 완료되었습니다.",{position:"top-right",duration:1e3}),await h.post("http://localhost:3000/chmatstatus",{RECEIPT_NO:d.RECEIPT_NO}),y.push("/qm/matlst"))}return(e,t)=>(ee(),X(de,null,[l(ce,{title:V.value.title,breadcrumbs:M.value},null,8,["title","breadcrumbs"]),l(me,null,{default:i(()=>[l(R,{justify:"end"},{default:i(()=>[l(T,null,{default:i(()=>[l(O,{color:"error",variant:"elevated",onClick:G,class:"mr-2"},{default:i(()=>t[1]||(t[1]=[_("초기화")])),_:1}),l(O,{color:"primary",variant:"elevated",onClick:H},{default:i(()=>t[2]||(t[2]=[_("등록")])),_:1})]),_:1})]),_:1}),l(f(x),{rowData:A.value,columnDefs:P.value,defaultColDef:N.value,rowSelection:Q.value,selectionColumnDef:I.value,gridOptions:k.value,theme:f(D),style:{height:"280px",width:"100%"},onGridReady:q,onFirstDataRendered:B,onSelectionChanged:C},null,8,["rowData","columnDefs","defaultColDef","rowSelection","selectionColumnDef","gridOptions","theme"]),l(R,{class:"my-4"},{default:i(()=>[l(T,{cols:"12",class:"py-1"},{default:i(()=>[w("div",ve,[t[3]||(t[3]=w("h5",{class:"mr-4"},"최종처리",-1)),l(le,{color:n.value=="합격"?"primary":"error"},{default:i(()=>[_(S(n.value),1)]),_:1},8,["color"]),w("span",ge,"선택 "+S(c.value)+"/"+S(u.value),1)])]),_:1})]),_:1}),te(l(ie,{class:"mb-4",elevation:"2"},{default:i(()=>[l(se,{class:"bg-red-lighten-5 text-red-darken-2"}),l(re,null,{default:i(()=>[l(ne,{modelValue:s.value.description,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value.description=a),label:"불합격 사유",variant:"outlined",rows:"3",counter:"500",maxlength:"500",rules:[a=>n.value==="합격"||a&&a.length>0||"불합격 시 사유는 필수입니다."]},null,8,["modelValue","rules"])]),_:1})]),_:1},512),[[oe,n.value==="불합격"]]),l(f(x),{rowData:m.value,columnDefs:F.value,gridOptions:z.value,theme:f(D),style:{height:"160px",width:"100%"}},null,8,["rowData","columnDefs","gridOptions","theme"])]),_:1})],64))}},Ee=pe(Ce,[["__scopeId","data-v-2d797eec"]]);export{Ee as default};
