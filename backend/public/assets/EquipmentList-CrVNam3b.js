import{aU as L,aV as B,O as l,a6 as O,_ as $,P as k,q,o as G,a as o,w as i,V as h,b as x,f as U,e as z,a0 as W,A as y,a1 as H,F as K,$ as r}from"./index-CGGVM91c.js";import{_ as Q,a as j}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{_ as J}from"./NewModal-RG6-e5WE.js";import{B as X}from"./main-Dfa23GB-.js";import{d as Z}from"./theme-bootstrap-maRaUoWN.js";const ee="http://localhost:3000/facility/status",ae="http://localhost:3000/process",te="http://localhost:3000/common/codes/FC",le="http://localhost:3000/common/codes/RR",ue={__name:"EquipmentList",setup(oe){L.registerModules([B]);const E=H,f=Z.useToast(),s=l(""),F=l(""),m=O({items:[]}),d=l({}),p=l({}),_=e=>(Array.isArray(e)?e:[]).reduce((a,t)=>(t!=null&&t.code&&(a[t.code]=t.code_name??t.code),a),{}),u=e=>typeof e=="string"?e.slice(0,10):e??"",P=l([{field:"공정코드",hide:!0,filter:"agTextColumnFilter"},{field:"설비코드",flex:1},{field:"설비명",flex:1},{headerName:"설비유형",flex:1,valueGetter:e=>{var a,t;return d.value[(a=e.data)==null?void 0:a.FAC_TYPE]||((t=e.data)==null?void 0:t.FAC_TYPE)||""}},{field:"사용유무",flex:1,cellStyle:e=>e.value==="사용"?{color:"blue",fontWeight:"bold"}:e.value==="정지"?{color:"red",fontWeight:"bold"}:null},{field:"제조사",flex:1},{field:"설비제조일",flex:1},{field:"설비설치일",flex:1},{field:"점검주기일",flex:1},{field:"고장유형",flex:1},{field:"담당자",flex:1}]),n=l(null),g=l(null),R=e=>{n.value=e.api,g.value=e.columnApi,s.value&&c(s.value)},c=e=>{n.value&&(n.value.setFilterModel({공정코드:{filterType:"text",type:"equals",filter:String(e)}}),n.value.onFilterChanged())},D=e=>({공정코드:e.PR_ID??"",설비코드:e.FAC_ID??"",설비명:e.FAC_NAME??"",FAC_TYPE:e.FAC_TYPE??"",사용유무:(e.FAC_USE??1)===1?"사용":"정지",제조사:e.FAC_COMPANY??"",설비제조일:u(e.FAC_MDATE),설비설치일:u(e.FAC_IDATE),점검주기일:e.FAC_CHECKDAY??"",고장유형:p.value[e.FS_TYPE]||(e.FS_TYPE??"-"),담당자:e.MANAGER??""}),T=async()=>{const[e,a]=await Promise.all([r.get(te),r.get(le)]);d.value=_(e.data),p.value=_(a.data)},b=async()=>{const{data:e}=await r.get(ee);m.items=(Array.isArray(e)?e:[]).map(D),s.value&&c(s.value)};$(async()=>{try{await T(),await b()}catch(e){console.error("[init] error:",e),f.error("초기 로딩 실패",{position:"top-right",duration:1e3})}});const C=l(null),A=l(""),v=l([]),N=l([{field:"공정코드",headerName:"공정코드",flex:1},{field:"공정명",headerName:"공정명",flex:1},{field:"설비유형",headerName:"설비유형",flex:1},{field:"등록일자",headerName:"등록일자",flex:1},{field:"작성자",headerName:"작성자",flex:1},{field:"비고",headerName:"비고",flex:1}]),w=e=>({공정코드:e.PR_ID??e.PRC_CODE??"",공정명:e.PRC_NAME??"",설비유형:d.value[e.FAC_TYPE]||e.FAC_TYPE||"",등록일자:u(e.PRC_RDATE),작성자:e.PRC_WRITER??"",비고:e.PRC_NOTE??""}),M=async()=>{const{data:e}=await r.get(ae);return(Array.isArray(e)?e:[]).map(w)},S=async e=>{var a;try{A.value=e,v.value=await M(),(a=C.value)==null||a.open()}catch(t){console.error("[process list] error:",t),f.error("공정 목록 조회 실패",{position:"top-right",duration:1e3})}},V=e=>{e&&(s.value=e.공정코드||"",F.value=e.공정명||"",e.공정코드&&c(e.공정코드))},Y=l({title:"설비 정보 관리"}),I=k([{title:"설비",disabled:!0,href:"#"},{title:"전체 조회",disabled:!1,href:"#"}]);return(e,a)=>(G(),q(K,null,[o(Q,{title:Y.value.title,breadcrumbs:I.value},null,8,["title","breadcrumbs"]),o(j,{title:"전체 조회"},{default:i(()=>[o(h,{class:"mb-2 py-0"},{default:i(()=>[o(x,{cols:"12",class:"d-flex align-center"},{default:i(()=>[o(U,{color:"warning",variant:"flat",onClick:a[0]||(a[0]=t=>S("공정 조회"))},{default:i(()=>a[2]||(a[2]=[z(" 공정 조회 ")])),_:1})]),_:1})]),_:1}),o(h,{class:"mb-4 pt-0"},{default:i(()=>[o(x,{cols:"12",md:"3"},{default:i(()=>[o(W,{label:"공정코드",modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=t=>s.value=t),readonly:"","hide-details":"",density:"comfortable",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),o(J,{ref_key:"modalRef",ref:C,title:A.value,rowData:v.value,colDefs:N.value,onConfirm:V},null,8,["title","rowData","colDefs"]),o(y(X),{style:{height:"460px","margin-top":"8px"},theme:y(E),rowData:m.items,columnDefs:P.value,animateRows:!0,suppressClickEdit:!0,pagination:!0,"pagination-page-size":10,onGridReady:R},null,8,["theme","rowData","columnDefs"])]),_:1})],64))}};export{ue as default};
