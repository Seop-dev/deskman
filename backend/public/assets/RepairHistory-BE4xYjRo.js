import{aU as v,aV as P,O as d,_ as V,y as Y,P as I,q as B,o as L,a as r,w as p,V as z,b as O,a0 as k,A as C,a1 as q,F as G,$ as i}from"./index-CGGVM91c.js";import{_ as H,a as U}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{B as j}from"./main-Dfa23GB-.js";import{d as K}from"./theme-bootstrap-maRaUoWN.js";const n="http://localhost:3000",te={__name:"RepairHistory",setup(Q){const F=K.useToast();v.registerModules([P]);const M=q,R=d([{field:"설비코드",flex:1},{field:"설비명",flex:1},{field:"설비유형",flex:1},{field:"고장유형",flex:1},{field:"비가동시작일",flex:1.5},{field:"수리완료일",flex:1.5},{field:"수리내역",flex:1.5},{field:"담당자",flex:1},{field:"비고",flex:2}]),h={editable:!1,sortable:!0,resizable:!0,suppressMenu:!0},f=d(""),c=d([]);function g(a){if(!a)return"";const t=new Date(a);if(Number.isNaN(t.getTime()))return String(a);const s=o=>String(o).padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())} ${s(t.getHours())}:${s(t.getMinutes())}:${s(t.getSeconds())}`}let _=new Map,w=new Map;const y=async()=>{const[a,t]=await Promise.all([i.get(`${n}/common/codes/FC`),i.get(`${n}/common/codes/RR`)]),s=o=>{const u=new Map;for(const e of o||[])u.set(String(e.code??e.CODE),e.code_name??e.CODE_NAME);return u};_=s(a.data),w=s(t.data)},x=async()=>(await i.get(`${n}/facility/repairs`)).data||[],A=async()=>(await i.get(`${n}/facility`)).data||[],D=async()=>(await i.get(`${n}/facility/status`)).data||[];V(async()=>{try{await y();const[a,t,s]=await Promise.all([x(),A(),D()]),o=new Map(t.map(e=>[e.FAC_ID,e])),u=new Map(s.map(e=>[e.FS_ID,e]));c.value=a.map(e=>{const l=o.get(e.FAC_ID)||{},$=u.get(e.FS_ID)||{},S=l.FAC_TYPE?_.get(String(l.FAC_TYPE))||l.FAC_TYPE:l.FAC_TYPE_NM||"",m=e.FR_TYPE??$.FS_TYPE??null,N=m?w.get(String(m))||m:"";return{설비코드:e.FAC_ID??"",설비명:l.FAC_NAME??"",설비유형:S,고장유형:N,비가동시작일:g(e.FR_STARTDAY),수리완료일:g(e.FR_ENDDAY),수리내역:e.FR_CONTENT??"",담당자:e.MANAGER??l.MANAGER??"",비고:e.FR_NOTE??""}})}catch(a){console.error("loadRepairs error",a),c.value=[],F.error("수리 내역 불러오기 실패",{position:"top-right",duration:1e3})}});const E=Y(()=>{const a=(f.value||"").trim().toLowerCase();return a?c.value.filter(t=>{const s=String(t.설비코드||"").toLowerCase(),o=String(t.설비명||"").toLowerCase();return s.includes(a)||o.includes(a)}):c.value}),b=d({title:"설비 수리 관리"}),T=I([{title:"설비",disabled:!0,href:"#"},{title:"수리 내역",disabled:!1,href:"#"}]);return(a,t)=>(L(),B(G,null,[r(H,{title:b.value.title,breadcrumbs:T.value},null,8,["title","breadcrumbs"]),r(U,{title:"수리 내역"},{default:p(()=>[r(z,{align:"center",class:"mb-3"},{default:p(()=>[r(O,{cols:"12",md:"6",class:"d-flex justify-start"},{default:p(()=>[r(k,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=s=>f.value=s),modelModifiers:{trim:!0},placeholder:"설비선택 (설비코드/설비명 입력)","hide-details":"",density:"compact",variant:"outlined",style:{"max-width":"280px"}},null,8,["modelValue"])]),_:1})]),_:1}),r(C(j),{class:"ag-theme-quartz grid-clean",style:{height:"420px"},theme:C(M),rowData:E.value,columnDefs:R.value,defaultColDef:h,animateRows:!0,pagination:!0,"pagination-page-size":10,suppressClickEdit:!0},null,8,["theme","rowData","columnDefs"])]),_:1})],64))}};export{te as default};
