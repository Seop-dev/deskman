import{aU as ee,aV as le,O as n,a6 as ae,_ as te,P as oe,q as se,o as x,a as o,w as s,c as ne,k as re,V as y,b as f,f as k,e as V,a0 as d,A as w,a1 as de,d as ue,a2 as ie,aT as me,a3 as fe,a4 as I,W as ce,F as pe,$ as c}from"./index-CGGVM91c.js";import{_ as Ae,a as Ce}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{_ as _e}from"./NewModal-RG6-e5WE.js";import{B as ye}from"./main-Dfa23GB-.js";import{d as Ve}from"./theme-bootstrap-maRaUoWN.js";const ge={class:"text-right mt-2"},p="http://localhost:3000",Pe={__name:"EquipmentModify",setup(ve){const u=Ve.useToast();ee.registerModules([le]);const M=de,N=`${p}/facility`,Y=`${p}/facilityUpdate`,U=`${p}/process`,h=`${p}/common/codes/FC`,A=n({}),C=n([]),S=e=>(Array.isArray(e)?e:[]).reduce((l,t)=>(l[t.code]=t.code_name??t.code,l),{}),$=async()=>{const{data:e}=await c.get(h);C.value=Array.isArray(e)?e:[],A.value=S(C.value)},r=n(""),m=n(null),B=n(null),L=e=>{m.value=e.api,B.value=e.columnApi,r.value&&_(r.value)},_=e=>{m.value&&(m.value.setFilterModel({공정코드:{filterType:"text",type:"equals",filter:String(e||"")}}),m.value.onFilterChanged())},g=n([]),O=n([{field:"공정코드",hide:!0,filter:"agTextColumnFilter"},{field:"설비코드",flex:1},{field:"설비명",flex:1},{headerName:"설비유형",flex:1,valueGetter:e=>{var l,t;return A.value[(l=e.data)==null?void 0:l.FAC_TYPE]||((t=e.data)==null?void 0:t.FAC_TYPE)||""}},{field:"사용유무",flex:1,cellStyle:e=>e.value==="사용"?{color:"blue",fontWeight:"bold"}:e.value==="정지"?{color:"red",fontWeight:"bold"}:null},{field:"제조사",flex:1},{field:"설비등록일",flex:1},{field:"설비설치일",flex:1},{field:"담당자",flex:1}]),G={editable:!1,sortable:!0,resizable:!0},v=e=>typeof e=="string"?e.slice(0,10):e??"",q=e=>({공정코드:e.PR_ID??"",설비코드:e.FAC_ID??"",설비명:e.FAC_NAME??"",FAC_TYPE:e.FAC_TYPE??"",사용유무:(e.FAC_USE??1)===1?"사용":"정지",제조사:e.FAC_COMPANY??"",설비등록일:v(e.FAC_MDATE),설비설치일:v(e.FAC_IDATE),담당자:e.MANAGER??"",PR_ID:e.PR_ID??"",FAC_CHECKDAY:e.FAC_CHECKDAY??null}),E=async()=>{const{data:e}=await c.get(N);g.value=(Array.isArray(e)?e:[]).map(q),r.value&&_(r.value)},a=ae({code:"",name:"",type:"",useYn:"",manufacturer:"",registeredAt:"",installedAt:"",manager:"",remark:"",prId:"",checkDay:null}),z=e=>{const l=e.data;a.code=l.설비코드,a.name=l.설비명,a.type=l.FAC_TYPE||"",a.useYn=l.사용유무||"",a.manufacturer=l.제조사||"",a.registeredAt=l.설비등록일||"",a.installedAt=l.설비설치일||"",a.manager=l.담당자||"",a.remark="",a.prId=l.PR_ID||l.공정코드||"",a.checkDay=l.FAC_CHECKDAY??null,r.value=a.prId||""},H=async()=>{var R,P,T;if(!a.code){u.error("수정할 설비를 선택하세요.",{position:"top-right",duration:1e3});return}const e=a.registeredAt?String(a.registeredAt).slice(0,10):null,l=a.installedAt?String(a.installedAt).slice(0,10):null,t={FAC_ID:a.code,FAC_NAME:a.name||null,FAC_TYPE:a.type||null,FAC_USE:a.useYn==="사용"?1:0,FAC_COMPANY:a.manufacturer||null,FAC_MDATE:e,FAC_IDATE:l,FAC_CHECKDAY:a.checkDay??null,PR_ID:a.prId||null,MANAGER:a.manager||null,MEMO:a.remark||null};try{(await c.put(Y,t,{headers:{"Content-Type":"application/json"}})).status===200?(u.success("수정 되었습니다",{position:"top-right",duration:1e3}),await E(),(R=m.value)==null||R.refreshCells({force:!0})):u.error("수정 실패",{position:"top-right",duration:1e3})}catch(i){console.error("[facility update] error:",i),u.error(((T=(P=i==null?void 0:i.response)==null?void 0:P.data)==null?void 0:T.error)||i.message||"수정 저장 실패",{position:"top-right",duration:1e3})}},D=n(null),b=n(""),F=n([]),K=n([{field:"공정코드",headerName:"공정코드",flex:1},{field:"공정명",headerName:"공정명",flex:1},{field:"설비유형",headerName:"설비유형",flex:1},{field:"등록일자",headerName:"등록일자",flex:1},{field:"작성자",headerName:"작성자",flex:1},{field:"비고",headerName:"비고",flex:1}]),W=e=>({공정코드:e.PR_ID??e.PRC_CODE??"",공정명:e.PRC_NAME??"",설비유형:A.value[e.FAC_TYPE]||e.FAC_TYPE||"",등록일자:typeof e.PRC_RDATE=="string"?e.PRC_RDATE.slice(0,10):e.PRC_RDATE??"",작성자:e.PRC_WRITER??"",비고:e.PRC_NOTE??""}),j=async()=>{const{data:e}=await c.get(U);return(Array.isArray(e)?e:[]).map(W)},Q=async e=>{var l;try{b.value=e,F.value=await j(),(l=D.value)==null||l.open()}catch(t){console.error("[process list] error:",t),u.error("공정 목록 조회 실패",{position:"top-right",duration:1e3})}},J=e=>{e&&(r.value=e.공정코드||"",_(e.공정코드))};te(async()=>{try{await $(),await E()}catch(e){console.error("[init] error:",e),u.error("초기 로딩 실패",{position:"top-right",duration:1e3})}});const X=n({title:"설비 정보 관리"}),Z=oe([{title:"설비",disabled:!0,href:"#"},{title:"설비 수정",disabled:!1,href:"#"}]);return(e,l)=>(x(),se(pe,null,[o(Ae,{title:X.value.title,breadcrumbs:Z.value},null,8,["title","breadcrumbs"]),o(Ce,{title:"설비 수정"},{default:s(()=>[o(y,{class:"mb-2 py-0"},{default:s(()=>[o(f,{cols:"12",class:"d-flex align-center"},{default:s(()=>[o(k,{color:"warning",variant:"flat",onClick:l[0]||(l[0]=t=>Q("공정 조회"))},{default:s(()=>l[11]||(l[11]=[V("공정 조회")])),_:1})]),_:1})]),_:1}),o(y,{class:"mb-4 pt-0"},{default:s(()=>[o(f,{cols:"12",md:"3"},{default:s(()=>[o(d,{label:"공정코드",modelValue:r.value,"onUpdate:modelValue":l[1]||(l[1]=t=>r.value=t),readonly:"","hide-details":"",density:"comfortable",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),o(w(ye),{style:{height:"220px"},theme:w(M),rowData:g.value,columnDefs:O.value,defaultColDef:G,animateRows:!0,suppressClickEdit:!0,pagination:!0,"pagination-page-size":10,onGridReady:L,onRowClicked:z},null,8,["theme","rowData","columnDefs"]),o(_e,{ref_key:"modalRef",ref:D,title:b.value,rowData:F.value,colDefs:K.value,onConfirm:J},null,8,["title","rowData","colDefs"]),a.code?(x(),ne(ce,{key:0,class:"mt-6 pa-4"},{default:s(()=>[o(y,{dense:""},{default:s(()=>[o(f,{cols:"12",md:"6"},{default:s(()=>[o(d,{label:"설비코드",modelValue:a.code,"onUpdate:modelValue":l[2]||(l[2]=t=>a.code=t),dense:"",outlined:"",readonly:""},null,8,["modelValue"]),o(d,{label:"설비명",modelValue:a.name,"onUpdate:modelValue":l[3]||(l[3]=t=>a.name=t),dense:"",outlined:""},null,8,["modelValue"]),o(ie,{label:"설비유형",modelValue:a.type,"onUpdate:modelValue":l[4]||(l[4]=t=>a.type=t),items:C.value,"item-title":"code_name","item-value":"code",dense:"",outlined:"",clearable:"",placeholder:"설비유형 선택"},null,8,["modelValue","items"]),o(d,{label:"제조사",modelValue:a.manufacturer,"onUpdate:modelValue":l[5]||(l[5]=t=>a.manufacturer=t),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(f,{cols:"12",md:"6"},{default:s(()=>[o(d,{label:"설비등록일",modelValue:a.registeredAt,"onUpdate:modelValue":l[6]||(l[6]=t=>a.registeredAt=t),type:"date",dense:"",outlined:""},null,8,["modelValue"]),o(d,{label:"설비설치일",modelValue:a.installedAt,"onUpdate:modelValue":l[7]||(l[7]=t=>a.installedAt=t),type:"date",dense:"",outlined:""},null,8,["modelValue"]),o(d,{label:"담당자",modelValue:a.manager,"onUpdate:modelValue":l[8]||(l[8]=t=>a.manager=t),dense:"",outlined:""},null,8,["modelValue"]),o(d,{label:"비고",modelValue:a.remark,"onUpdate:modelValue":l[9]||(l[9]=t=>a.remark=t),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(f,{cols:"12",md:"6"},{default:s(()=>[o(me,{class:"mb-2 d-block"},{default:s(()=>l[12]||(l[12]=[V("사용유무")])),_:1}),o(fe,{modelValue:a.useYn,"onUpdate:modelValue":l[10]||(l[10]=t=>a.useYn=t),inline:""},{default:s(()=>[o(I,{label:"사용",value:"사용"}),o(I,{label:"정지",value:"정지"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),ue("div",ge,[o(k,{color:"success",onClick:H},{default:s(()=>l[13]||(l[13]=[V("수정")])),_:1})])]),_:1})):re("",!0)]),_:1})],64))}};export{Pe as default};
