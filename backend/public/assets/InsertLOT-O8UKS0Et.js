import{_ as I,a as M}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{B as R}from"./main-Dfa23GB-.js";import{O as o,P as L,q as P,o as k,a as l,w as r,V as C,f,e as d,b as w,a0 as S,A as g,a1 as $,F as B,$ as m}from"./index-CGGVM91c.js";import{_ as F}from"./NewModal-RG6-e5WE.js";import{u as Q}from"./auth-B63OrgMx.js";import{d as Y}from"./theme-bootstrap-maRaUoWN.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={__name:"InsertLOT",setup(z){var x;const n=Y.useToast(),c=Q(),E=$,s=o([]),N=o([{field:"입고번호",flex:1},{field:"자재명",flex:1},{field:"자재코드",flex:1},{field:"규격",flex:1},{field:"단위",flex:1},{field:"발주수량",headerName:"발주 수량",flex:1},{field:"입고수량",headerName:"입고 수량",flex:1},{field:"합격수량",headerName:"합격 수량",flex:1}]),i=o(((x=c.user)==null?void 0:x.name)||""),u=o(null),p=o(""),T=o([]),h=o([]),_=[{field:"입고번호",headerName:"입고번호",flex:1.5},{field:"자재명",headerName:"자재명",flex:1},{field:"자재코드",headerName:"자재코드",flex:1},{field:"규격",headerName:"규격",flex:1.5},{field:"단위",headerName:"단위",flex:1},{field:"합격수량",headerName:"합격수량",flex:1}],D=o([]),A=async t=>{p.value=t,h.value=_;try{const e=await m.get("http://localhost:3000/materialPass");T.value=e.data.map(a=>({입고번호:a.RECEIPT_NO,자재명:a.MAT_NAME,자재코드:a.MAT_CODE,규격:a.MAT_SIZE,단위:a.MAT_UNIT,합격수량:a.TOTAL_QTY,발주수량:a.RECEIPT_QTY,입고수량:a.RECEIVED_QTY})),u.value&&u.value.open()}catch(e){console.error(e),n.error("원자재 합격품 목록을 불러오는 데 실패했습니다.",{position:"top-right",duration:2e3})}};function O(t){Array.isArray(t)||(t=[t]),t.forEach(e=>{s.value.push({입고번호:e.입고번호||"",자재명:e.자재명||"",자재코드:e.자재코드||"",규격:e.규격||"",단위:e.단위||"",발주수량:e.발주수량||0,입고수량:e.입고수량||0,합격수량:e.합격수량||0})})}function v(){var t;i.value=((t=c.user)==null?void 0:t.name)||"",s.value=[]}async function b(){if(!i.value){n.warning("담당자를 입력해주세요.",{position:"top-right",duration:2e3});return}if(s.value.length===0){n.warning("등록할 LOT가 없습니다.",{position:"top-right",duration:2e3});return}try{s.value.map(a=>m.post("http://localhost:3000/LOTInsert",{MAT_CODE:a.자재코드,MANAGER:i.value,MAT_QTY:a.합격수량,RECEIPT_NO:a.입고번호}));const t=s.value.map(a=>a.입고번호),e=[...new Set(t)];await Promise.all(e.map(a=>m.put("http://localhost:3000/updateTMP",{RECEIPT_NO:a,STATUS:"입고 완료"}))),n.success("LOT 등록이 완료되었습니다.",{position:"top-right",duration:1500}),v()}catch(t){console.error(t),n.error("LOT 등록 중 오류가 발생했습니다.",{position:"top-right",duration:2e3})}}const V=o({title:"재고"}),y=L([{title:"자재",disabled:!0,href:"#"},{title:"LOT 등록",disabled:!1,href:"#"}]);return(t,e)=>(k(),P(B,null,[l(I,{title:V.value.title,breadcrumbs:y.value},null,8,["title","breadcrumbs"]),l(M,{title:"LOT 등록"},{default:r(()=>[l(F,{ref_key:"modalRef",ref:u,title:p.value,rowData:T.value,colDefs:h.value,onConfirm:O},null,8,["title","rowData","colDefs"]),l(C,{class:"mb-4"},{default:r(()=>[l(f,{color:"warning",class:"mr-2 button",onClick:e[0]||(e[0]=a=>A("원자재 합격 수량 조회",D.value,_)),style:{"margin-bottom":"2rem"}},{default:r(()=>e[2]||(e[2]=[d(" 원자재 합격 수량 조회 ")])),_:1}),l(w,{cols:"3"},{default:r(()=>[l(S,{label:"담당자",modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),outlined:"",style:{"margin-left":"2rem"}},null,8,["modelValue"])]),_:1})]),_:1}),l(g(R),{rowData:s.value,columnDefs:N.value,theme:g(E),style:{height:"200px",width:"100%"},onCellValueChanged:t.onCellValueChanged},null,8,["rowData","columnDefs","theme","onCellValueChanged"]),l(C,{justify:"end",style:{"margin-top":"2rem"}},{default:r(()=>[l(f,{color:"error",class:"mr-2",onClick:v},{default:r(()=>e[3]||(e[3]=[d("초기화")])),_:1}),l(f,{color:"primary",onClick:b},{default:r(()=>e[4]||(e[4]=[d("등록")])),_:1})]),_:1})]),_:1})],64))}},X=q(U,[["__scopeId","data-v-5ccaed38"]]);export{X as default};
