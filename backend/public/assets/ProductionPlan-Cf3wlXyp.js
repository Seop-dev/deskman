import{O as f,P as oe,_ as re,$ as _,y as C,q as de,o as x,a as o,w as r,d as i,f as g,e as v,V as ue,b as c,a0 as m,aH as ne,aI as se,A as Q,c as ie,k as ce,t as Y,j as me,Y as fe,W as pe,S as ve,T as ge,Z as ye,a8 as De,F as Ce}from"./index-CGGVM91c.js";import{_ as we,a as Ve}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{B as M}from"./main-Dfa23GB-.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"card-headline only-right"},Ne={class:"right-actions"},he={class:"center-actions-under-note"},Re={class:"pane mt-4"},Te={class:"pane-head"},Ee={class:"pane-action"},be={class:"table-footline"},N="http://localhost:3000",Se=5,ke=10,Oe={__name:"ProductionPlan",setup(Ue){const W=f({title:"생산계획 관리"}),$=oe([{title:"생산",disabled:!0,href:"#"},{title:"생산계획 관리",disabled:!1,href:"#"}]),l=f({issueNumber:"",orderDate:"",contact:"",orderNo:"",productCode:"",dueDate:"",dueDate2:"",targetQty:0,productName:"",memo:"",productType:""});function b(){const t=new Date;return`PL-${t.getFullYear()}${String(t.getMonth()+1).padStart(2,"0")}${String(t.getDate()).padStart(2,"0")}-${Math.floor(Math.random()*9e3)+1e3}`}re(()=>{l.value.issueNumber=b(),k().catch(()=>{})});const S=f([]),w=f("");async function k(){try{const{data:t}=await _.get(`${N}/products`,{params:{kw:w.value,page:1,size:50}});S.value=Array.isArray(t==null?void 0:t.rows)?t.rows:[]}catch(t){console.error(t),d("제품 조회 오류","error")}}const V=C(()=>l.value.productType||null),z=C(()=>{const t=w.value.trim().toLowerCase();return S.value.filter(e=>!V.value||e.type===V.value).filter(e=>!t||e.code.toLowerCase().includes(t)||e.name.toLowerCase().includes(t))}),I=C(()=>z.value),n={cellStyle:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},tooltipValueGetter:t=>t.value},O={...n,cellClass:"ag-right-aligned-cell",valueFormatter:t=>t.value==null?"":String(t.value)},L=[{headerName:"제품코드",field:"code",flex:1.1,minWidth:120,...n},{headerName:"제품명칭",field:"name",flex:1.6,minWidth:140,...n},{headerName:"유형",field:"type",flex:.8,minWidth:90,...n},{headerName:"단위",field:"uom",flex:.6,minWidth:70,...n},{headerName:"규격",field:"spec",flex:1.2,minWidth:120,...n},{headerName:"현재고",field:"stock",flex:.7,minWidth:80,...O}];let s;function F(t){s=t.api,h()}function G(t){t&&t.sizeColumnsToFit()}function h(){G(s)}function B(){var a;if(!s)return d("그리드 준비중입니다.","error");const t=((a=s.getSelectedRows)==null?void 0:a.call(s))??[];if(!t.length)return d("등록할 제품을 선택하세요.","error");const e=t[0];if(l.value.productType||(l.value.productType=e.type),l.value.productType!==e.type)return d(`선택 가능한 유형은 '${l.value.productType}' 입니다.`,"error");l.value.productCode=e.code,l.value.productName=e.name,d("제품이 계획서에 등록되었습니다.")}const y=f(!1),U=f(""),R=f([]),T=f([]);async function A(){try{const{data:t}=await _.get(`${N}/reqSelect`);R.value=Array.isArray(t)?t.map(e=>({...e,REQ_QTY:Number(e.REQ_QTY)})):[]}catch(t){console.error(t),d("주문서 조회 오류","error")}}const q=C(()=>{const t=U.value.trim().toLowerCase();return t?R.value.filter(e=>String(e.REQ_ID).toLowerCase().includes(t)||String(e.CUS_NAME).toLowerCase().includes(t)||String(e.PRD_NAME).toLowerCase().includes(t)):R.value}),K=C(()=>q.value),j=[{headerName:"",checkboxSelection:!0,headerCheckboxSelection:!0,width:70},{headerName:"주문일자",field:"REQ_DATE",minWidth:120,...n},{headerName:"주문번호",field:"REQ_ID",minWidth:120,...n},{headerName:"업체명",field:"CUS_NAME",minWidth:120,flex:1,...n},{headerName:"제품코드",field:"PRD_CODE",minWidth:110,...n},{headerName:"제품명",field:"PRD_NAME",minWidth:140,flex:1,...n},{headerName:"제품유형",field:"PRODUCT_TYPE",width:100,...n},{headerName:"주문수량",field:"REQ_QTY",width:100,...O},{headerName:"납기일자",field:"REQ_DDAY",minWidth:120,...n},{headerName:"주문상태",field:"REQ_STATUS",width:100,...n}];let u;function H(t){var e;u=t.api,(e=u.sizeColumnsToFit)==null||e.call(u)}function Z(t){const e=t.api.getSelectedRows();if(e.length<=1)return;const a=e[0];for(const p of e.slice(1)){const E=p.PRD_CODE===a.PRD_CODE,ae=(p.PRODUCT_TYPE??"")===(a.PRODUCT_TYPE??"");if(!E||a.PRODUCT_TYPE&&!ae){t.api.forEachNode(P=>{P.isSelected()&&(P.data.PRD_CODE!==a.PRD_CODE||a.PRODUCT_TYPE&&P.data.PRODUCT_TYPE!==a.PRODUCT_TYPE)&&P.setSelected(!1)}),d("같은 제품(유형)만 복수 선택 가능합니다.","error");break}}}function J(){U.value="",y.value=!0,setTimeout(()=>{var t;return(t=u==null?void 0:u.deselectAll)==null?void 0:t.call(u)},0),A()}function X(){var a;if(!u)return d("그리드 준비중입니다.","error");const t=((a=u.getSelectedRows)==null?void 0:a.call(u))??[];if(!t.length)return d("선택된 주문서가 없습니다.","error");const e=t[0];l.value.orderNo=e.REQ_ID,l.value.productCode=e.PRD_CODE,l.value.productName=e.PRD_NAME,e.PRODUCT_TYPE&&(l.value.productType=e.PRODUCT_TYPE),l.value.targetQty=t.reduce((p,E)=>p+Number(E.REQ_QTY||0),0),l.value.dueDate2=[...t.map(p=>p.REQ_DDAY)].sort()[0],T.value=t.map(p=>String(p.REQ_ID)),y.value=!1,d("주문서가 적용되었습니다.")}async function ee(){if(!l.value.issueNumber||!l.value.orderDate)return d("계획번호/계획명을 입력하세요.","error");if(!l.value.productCode)return d("제품을 등록하세요.","error");if(!l.value.contact)return d("작성자를 입력하세요.","error");if(!l.value.dueDate)return d("작성일자를 입력하세요.","error");if(!l.value.dueDate2)return d("납기일자를 입력하세요.","error");if(!l.value.targetQty||l.value.targetQty<=0)return d("총 수량을 입력하세요.","error");try{const{data:t}=await _.post(`${N}/plans`,{form:l.value,linkedOrderIds:T.value});t!=null&&t.ok?(d("저장되었습니다."),await te()):d("저장 실패","error")}catch(t){console.error(t),d("저장 중 오류","error")}}async function te(){try{const{data:t}=await _.get(`${N}/plans`,{params:{kw:"",page:1,size:20}});t!=null&&t.ok&&console.log("생산계획 목록",t.rows)}catch(t){console.error(t)}}function le(){var e,a;const t=b();l.value={issueNumber:t,orderDate:"",contact:"",orderNo:"",productCode:"",dueDate:"",dueDate2:"",targetQty:0,productName:"",memo:"",productType:""},(e=s==null?void 0:s.deselectAll)==null||e.call(s),(a=u==null?void 0:u.deselectAll)==null||a.call(u),d("초기화되었습니다."),T.value=[]}const D=f({open:!1,msg:"",color:"primary"}),d=(t,e="primary")=>D.value={open:!0,msg:t,color:e};return(t,e)=>(x(),de(Ce,null,[o(we,{title:W.value.title,breadcrumbs:$.value},null,8,["title","breadcrumbs"]),o(Ve,null,{default:r(()=>[i("div",_e,[e[15]||(e[15]=i("h5",{class:"title"},"생산계획 등록",-1)),i("div",Ne,[o(g,{color:"warning",onClick:J},{default:r(()=>e[14]||(e[14]=[v("주문서 조회")])),_:1})])]),o(ue,{class:"mb-2"},{default:r(()=>[o(c,{cols:"4"},{default:r(()=>[o(m,{label:"계획번호",modelValue:l.value.issueNumber,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.issueNumber=a),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(m,{label:"계획명",modelValue:l.value.orderDate,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.orderDate=a),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(m,{label:"작성자",modelValue:l.value.contact,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.contact=a),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(m,{label:"주문번호",modelValue:l.value.orderNo,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.orderNo=a),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(m,{label:"작성일자",modelValue:l.value.dueDate,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.dueDate=a),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(m,{label:"납기일자",modelValue:l.value.dueDate2,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.dueDate2=a),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(m,{label:"총 수량",modelValue:l.value.targetQty,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.targetQty=a),modelModifiers:{number:!0},type:"number",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(m,{label:"제품코드",modelValue:l.value.productCode,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.productCode=a),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(m,{label:"제품명칭",modelValue:l.value.productName,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.productName=a),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"12"},{default:r(()=>[o(ne,{label:"비고",modelValue:l.value.memo,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.memo=a),modelModifiers:{trim:!0},rows:"2","auto-grow":"",dense:"",variant:"outlined",class:"text-right"},null,8,["modelValue"])]),_:1})]),_:1}),i("div",he,[o(g,{variant:"flat",color:"error",onClick:le},{default:r(()=>e[16]||(e[16]=[v("초기화")])),_:1}),o(g,{color:"primary",onClick:ee},{default:r(()=>e[17]||(e[17]=[v("생산계획 등록")])),_:1})]),i("section",Re,[i("div",Te,[e[19]||(e[19]=i("h5",{class:"pane-title"},"제품목록",-1)),i("div",Ee,[o(m,{modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=a=>w.value=a),modelModifiers:{trim:!0},placeholder:"제품코드/명 검색","hide-details":"",density:"compact",variant:"outlined",class:"search-input-right",onKeyup:se(k,["enter"])},null,8,["modelValue"]),o(g,{color:"primary",class:"ml-2",onClick:B},{default:r(()=>e[18]||(e[18]=[v("제품 등록")])),_:1})])]),o(Q(M),{class:"ag-theme-quartz ag-no-wrap",rowData:I.value,columnDefs:L,pagination:!0,paginationPageSize:Se,suppressPaginationPanel:!1,domLayout:"autoHeight",rowSelection:"single",rowMultiSelectWithClick:!1,onGridReady:F,onFirstDataRendered:h,onGridSizeChanged:h},null,8,["rowData"]),i("div",be,[V.value?(x(),ie(me,{key:0,size:"small",color:"primary",variant:"tonal"},{default:r(()=>[v(" 선택 고정 유형: "+Y(V.value),1)]),_:1})):ce("",!0)])]),o(fe,{modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=a=>y.value=a),width:"90vw"},{default:r(()=>[o(pe,{class:"plan-card"},{default:r(()=>[o(ve,{class:"d-flex align-center justify-space-between"},{default:r(()=>e[20]||(e[20]=[i("span",null,"주문서 목록",-1)])),_:1}),o(ge,{class:"dialog-body"},{default:r(()=>[o(Q(M),{class:"ag-theme-quartz ag-no-wrap",rowData:K.value,columnDefs:j,pagination:!0,paginationPageSize:ke,rowSelection:"multiple",rowMultiSelectWithClick:!0,suppressRowClickSelection:!0,domLayout:"autoHeight",onGridReady:H,onSelectionChanged:Z},null,8,["rowData"])]),_:1}),o(ye,{class:"justify-end"},{default:r(()=>[o(g,{variant:"flat",color:"darkText",onClick:e[11]||(e[11]=a=>y.value=!1)},{default:r(()=>e[21]||(e[21]=[v("닫기")])),_:1}),o(g,{variant:"flat",color:"success",onClick:X},{default:r(()=>e[22]||(e[22]=[v("적용")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(De,{modelValue:D.value.open,"onUpdate:modelValue":e[13]||(e[13]=a=>D.value.open=a),color:D.value.color,timeout:2e3},{default:r(()=>[v(Y(D.value.msg),1)]),_:1},8,["modelValue","color"])]),_:1})],64))}},We=Pe(Oe,[["__scopeId","data-v-bc142b9f"]]);export{We as default};
