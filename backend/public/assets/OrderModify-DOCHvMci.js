import{O as w,P as M,_ as j,y as h,am as G,a6 as q,a5 as Z,q as L,o as U,a as o,w as r,d as V,f as b,e as f,V as D,b as u,a0 as i,aI as C,A as S,Y,W as H,S as J,c as X,k as A,j as ee,T as le,Z as te,a8 as oe,t as ae,F as re,$ as k}from"./index-CGGVM91c.js";import{_ as de,a as se}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{B as ue}from"./main-Dfa23GB-.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"card-headline"},me={class:"head-actions"},ce={class:"grid-wrap"},x="http://localhost:3000",fe=10,pe={__name:"OrderModify",setup(ye){const z=w({title:"작업지시 수정/삭제"}),Q=M([{title:"생산",disabled:!0,href:"#"},{title:"작업지시 수정/삭제",disabled:!1,href:"#"}]),y=w({open:!1,msg:"",color:"primary"}),m=(a,e="primary")=>y.value={open:!0,msg:a,color:e},s=w({issueNumber:"",orderName:"",productCode:"",contact:""}),p=M([]);async function g(){const a=(s.value.issueNumber||s.value.orderName||s.value.productCode||s.value.contact||"").trim();try{const{data:e}=await k.get(`${x}/workorders`,{params:{kw:a,page:1,size:500}});e!=null&&e.ok?(p.value=(e.rows||[]).map(l=>({id:l.id,issueNumber:l.issueNumber,orderName:l.orderName||"",orderDate:l.orderDate,contact:l.contact,productCode:l.productCode,productName:l.productName,dueDate:l.dueDate,targetQty:l.targetQty,memo:l.memo||"",status:l.status||"OPEN",_hay:(l.issueNumber+(l.orderName||"")+l.productCode+l.productName+l.contact).toLowerCase()})),m("조회 완료")):m("조회 실패","error")}catch(e){console.error(e),m("조회 오류","error")}}j(g);const W=h(()=>{const a=s.value;return p.value.filter(e=>(!a.issueNumber||e.issueNumber.includes(a.issueNumber))&&(!a.orderName||e.orderName.includes(a.orderName))&&(!a.productCode||e.productCode.includes(a.productCode))&&(!a.contact||e.contact.includes(a.contact)))}),_=h(()=>W.value);function N(){g().then(()=>d==null?void 0:d.ensureIndexVisible(0))}function I(){s.value={issueNumber:"",orderName:"",productCode:"",contact:""},g().then(()=>d==null?void 0:d.ensureIndexVisible(0))}const R=G([{headerName:"",checkboxSelection:!0,headerCheckboxSelection:!0,width:70},{headerName:"지시번호",field:"issueNumber",flex:1.1,minWidth:140,cellClass:"cell-ellipsis"},{headerName:"지시명",field:"orderName",flex:1.3,minWidth:160,cellClass:"cell-ellipsis"},{headerName:"지시일자",field:"orderDate",flex:.9,minWidth:120,cellClass:"cell-ellipsis"},{headerName:"작성자",field:"contact",flex:.8,minWidth:90,cellClass:"cell-ellipsis"},{headerName:"제품코드",field:"productCode",flex:.9,minWidth:110,cellClass:"cell-ellipsis"},{headerName:"제품명칭",field:"productName",flex:1.2,minWidth:150,cellClass:"cell-ellipsis"},{headerName:"납기일자",field:"dueDate",flex:.9,minWidth:120,cellClass:"cell-ellipsis"},{headerName:"목표수량",field:"targetQty",flex:.7,minWidth:90,cellClass:"ag-right-aligned-cell cell-ellipsis"},{headerName:"비고",field:"memo",flex:1.2,minWidth:140,cellClass:"cell-ellipsis"}]);let d=null;function T(a){d=a.api,d.sizeColumnsToFit()}function B(a){return String(a.data.id)}const t=q({open:!1,dirty:!1,form:{id:null,issueNumber:"",orderName:"",orderDate:"",contact:"",productCode:"",productName:"",dueDate:"",targetQty:0,memo:""},original:null});function c(){t.dirty=!0}function $(a){const e=a==null?void 0:a.data;e&&(t.form={id:e.id,issueNumber:e.issueNumber,orderName:e.orderName,orderDate:e.orderDate,contact:e.contact,productCode:e.productCode,productName:e.productName,dueDate:e.dueDate,targetQty:e.targetQty,memo:e.memo},t.original={...e},t.dirty=!1,t.open=!0)}function E(){t.dirty&&!confirm("저장하지 않은 변경 사항이 있습니다. 닫을까요?")||(t.open=!1)}function O(){var e,l,n;const a=t.form;return!a.orderDate||!((e=a.contact)!=null&&e.trim())||!((l=a.productCode)!=null&&l.trim())||!((n=a.productName)!=null&&n.trim())||!a.dueDate?(alert("지시일자, 작성자, 제품코드, 제품명칭, 납기일자는 필수입니다."),!1):!a.targetQty||a.targetQty<=0?(alert("목표수량은 1 이상이어야 합니다."),!1):!0}async function F(){if(O())try{const a={orderName:t.form.orderName||null,orderDate:t.form.orderDate,contact:t.form.contact,productCode:t.form.productCode,productName:t.form.productName,dueDate:t.form.dueDate,targetQty:Number(t.form.targetQty||0),memo:t.form.memo||""},{data:e}=await k.put(`${x}/workorders/${t.form.id}`,a);if(e!=null&&e.ok){const l={...t.original,...t.form};d==null||d.applyTransactionAsync({update:[l]});const n=p.value.slice(),v=n.findIndex(P=>P.id===l.id);v>-1&&(n[v]=l),p.value=n,t.open=!1,t.dirty=!1,m("수정되었습니다.","success")}else m("수정 실패","error")}catch(a){console.error(a),m("수정 오류","error")}}async function K(){if(!d)return;const a=d.getSelectedRows();if(!a.length)return alert("삭제할 행을 선택하세요.");if(confirm(`${a.length}건을 삭제하시겠습니까?`))try{const e=a.map(n=>n.id),{data:l}=await k.delete(`${x}/workorders`,{data:{ids:e}});if(l!=null&&l.ok){d.applyTransactionAsync({remove:a});const n=new Set(e);p.value=p.value.filter(v=>!n.has(v.id)),t.open&&t.form.id&&n.has(t.form.id)&&(t.open=!1),m("삭제되었습니다.","success")}else m("삭제 실패","error")}catch(e){console.error(e),m("삭제 오류","error")}}return Z(s,()=>{d==null||d.ensureIndexVisible(0)},{deep:!0}),(a,e)=>(U(),L(re,null,[o(de,{title:z.value.title,breadcrumbs:Q.value},null,8,["title","breadcrumbs"]),o(se,null,{default:r(()=>[V("div",ne,[e[16]||(e[16]=V("h5",{class:"title"},"작업지시 수정/삭제",-1)),V("div",me,[o(b,{class:"ml-4",color:"error",variant:"elevated",onClick:K},{default:r(()=>e[15]||(e[15]=[f("삭제")])),_:1})])]),o(D,{class:"mb-4",dense:""},{default:r(()=>[o(u,{cols:"3"},{default:r(()=>[o(i,{label:"지시번호",modelValue:s.value.issueNumber,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.issueNumber=l),modelModifiers:{trim:!0},dense:"",outlined:"","hide-details":"",onKeyup:C(N,["enter"])},null,8,["modelValue"])]),_:1}),o(u,{cols:"3"},{default:r(()=>[o(i,{label:"지시명",modelValue:s.value.orderName,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.orderName=l),modelModifiers:{trim:!0},dense:"",outlined:"","hide-details":"",onKeyup:C(N,["enter"])},null,8,["modelValue"])]),_:1}),o(u,{cols:"3"},{default:r(()=>[o(i,{label:"제품코드",modelValue:s.value.productCode,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.productCode=l),modelModifiers:{trim:!0},dense:"",outlined:"","hide-details":"",onKeyup:C(N,["enter"])},null,8,["modelValue"])]),_:1}),o(u,{cols:"3"},{default:r(()=>[o(i,{label:"작성자",modelValue:s.value.contact,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.contact=l),modelModifiers:{trim:!0},dense:"",outlined:"","hide-details":"",onKeyup:C(N,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),o(D,{justify:"center",class:"mt-2 mb-4"},{default:r(()=>[o(u,{cols:"auto"},{default:r(()=>[o(b,{variant:"flat",color:"error",class:"mx-2",onClick:I},{default:r(()=>e[17]||(e[17]=[f("초기화")])),_:1}),o(b,{variant:"flat",color:"darkText",class:"mx-2",onClick:N},{default:r(()=>e[18]||(e[18]=[f("검색")])),_:1})]),_:1})]),_:1}),V("div",ce,[o(S(ue),{class:"ag-theme-quartz ag-no-wrap",rowData:_.value,columnDefs:S(R),pagination:!0,paginationPageSize:fe,rowSelection:"multiple",rowMultiSelectWithClick:!0,suppressRowClickSelection:!0,immutableData:!0,getRowId:B,rowBuffer:3,onGridReady:T,onRowDoubleClicked:$},null,8,["rowData","columnDefs"])]),o(Y,{modelValue:t.open,"onUpdate:modelValue":e[13]||(e[13]=l=>t.open=l),"max-width":"760",persistent:""},{default:r(()=>[o(H,null,{default:r(()=>[o(J,{class:"d-flex align-center justify-space-between"},{default:r(()=>[e[20]||(e[20]=V("span",null,"작업지시 수정",-1)),t.dirty?(U(),X(ee,{key:0,size:"small",color:"warning",variant:"tonal"},{default:r(()=>e[19]||(e[19]=[f("변경됨")])),_:1})):A("",!0)]),_:1}),o(le,null,{default:r(()=>[o(D,null,{default:r(()=>[o(u,{cols:"6",md:"4"},{default:r(()=>[o(i,{label:"지시번호",modelValue:t.form.issueNumber,"onUpdate:modelValue":e[4]||(e[4]=l=>t.form.issueNumber=l),readonly:"",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),o(u,{cols:"6",md:"8"},{default:r(()=>[o(i,{label:"지시명",modelValue:t.form.orderName,"onUpdate:modelValue":[e[5]||(e[5]=l=>t.form.orderName=l),c],modelModifiers:{lazy:!0},density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),o(u,{cols:"6",md:"4"},{default:r(()=>[o(i,{label:"지시일자",modelValue:t.form.orderDate,"onUpdate:modelValue":[e[6]||(e[6]=l=>t.form.orderDate=l),c],modelModifiers:{lazy:!0},type:"date",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),o(u,{cols:"6",md:"4"},{default:r(()=>[o(i,{label:"작성자",modelValue:t.form.contact,"onUpdate:modelValue":[e[7]||(e[7]=l=>t.form.contact=l),c],modelModifiers:{lazy:!0},density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),o(u,{cols:"6",md:"4"},{default:r(()=>[o(i,{label:"제품코드",modelValue:t.form.productCode,"onUpdate:modelValue":[e[8]||(e[8]=l=>t.form.productCode=l),c],modelModifiers:{lazy:!0},density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),o(u,{cols:"6",md:"8"},{default:r(()=>[o(i,{label:"제품명칭",modelValue:t.form.productName,"onUpdate:modelValue":[e[9]||(e[9]=l=>t.form.productName=l),c],modelModifiers:{lazy:!0},density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),o(u,{cols:"6",md:"4"},{default:r(()=>[o(i,{label:"납기일자",modelValue:t.form.dueDate,"onUpdate:modelValue":[e[10]||(e[10]=l=>t.form.dueDate=l),c],modelModifiers:{lazy:!0},type:"date",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),o(u,{cols:"6",md:"4"},{default:r(()=>[o(i,{label:"목표수량",modelValue:t.form.targetQty,"onUpdate:modelValue":[e[11]||(e[11]=l=>t.form.targetQty=l),c],modelModifiers:{number:!0,lazy:!0},type:"number",min:"1",step:"1",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),o(u,{cols:"12"},{default:r(()=>[o(i,{label:"비고",modelValue:t.form.memo,"onUpdate:modelValue":[e[12]||(e[12]=l=>t.form.memo=l),c],modelModifiers:{lazy:!0},placeholder:"메모",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(te,{class:"justify-end"},{default:r(()=>[o(b,{variant:"flat",color:"darkText",onClick:E},{default:r(()=>e[21]||(e[21]=[f("닫기")])),_:1}),o(b,{variant:"flat",color:"success",onClick:F},{default:r(()=>e[22]||(e[22]=[f("수정")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(oe,{modelValue:y.value.open,"onUpdate:modelValue":e[14]||(e[14]=l=>y.value.open=l),color:y.value.color,timeout:2e3},{default:r(()=>[f(ae(y.value.msg),1)]),_:1},8,["modelValue","color"])]),_:1})],64))}},Ce=ie(pe,[["__scopeId","data-v-926859de"]]);export{Ce as default};
