import{_ as O,a as w}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{B as I}from"./main-Dfa23GB-.js";import{O as s,a6 as k,P as U,q,o as $,a as l,w as r,V as u,f as d,e as m,b as c,a0 as p,A,a1 as B,F,$ as v}from"./index-CGGVM91c.js";import{_ as P}from"./NewModal-RG6-e5WE.js";import{u as Q}from"./auth-B63OrgMx.js";import{d as z}from"./theme-bootstrap-maRaUoWN.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={__name:"MaterialEquest",setup(Y){var x;const n=z.useToast(),D=Q(),E=B,i=s([]),C=s([{field:"입고번호",flex:1.5},{field:"자재명",flex:1},{field:"자재코드",flex:1},{field:"규격",flex:1},{field:"단위",flex:1},{field:"수량",flex:1},{field:"사유",flex:1.5}]),o=k({insertDate:new Date().toISOString().slice(0,10),reDate:"",manager:((x=D.user)==null?void 0:x.name)||""}),f=s(null),_=s(""),g=s([]),T=s([]),b=[{field:"입고번호",headerName:"입고번호",flex:1.5},{field:"자재명",headerName:"자재명",flex:1},{field:"자재코드",headerName:"자재코드",flex:1},{field:"규격",headerName:"규격",flex:1.5},{field:"단위",headerName:"단위",flex:.8},{field:"수량",headerName:"수량",flex:1},{field:"상태",flex:.8,cellStyle:t=>t.value==="등록"?{color:"black",fontWeight:"bold"}:t.value==="완료"?{color:"red",fontWeight:"bold"}:null}],V=s([]),S=async t=>{_.value=t,T.value=b;try{const e=await v.get("http://localhost:3000/failMaterials");g.value=e.data.filter(a=>a.MAT_STATUS!=="완료").map(a=>({입고번호:a.RECEIPT_NO,자재명:a.MAT_NAME,자재코드:a.MAT_CODE,규격:a.MAT_SIZE,단위:a.MAT_UNIT,수량:a.TOTAL_QTY,상태:a.MAT_STATUS,사유:a.RJT_REASON})),f.value&&f.value.open()}catch(e){console.error("자재 목록을 가져오는 중 오류가 발생했습니다:"+e),n.error("자재 목록을 불러오는 데 실패했습니다.",{position:"top-right",duration:2e3})}};function y(t){Array.isArray(t)||(t=[t]),t.forEach(e=>{i.value.push({입고번호:e.입고번호||"",자재명:e.자재명||"",자재코드:e.자재코드||"",규격:e.규격||"",단위:e.단위||"",수량:e.수량||0,사유:e.사유||""})})}function h(){var t;o.manager=((t=D.user)==null?void 0:t.name)||"",o.insertDate=new Date().toISOString().substring(0,10),o.reDate="",i.value=[]}async function M(){try{if(!o.manager||!o.insertDate||!o.reDate){n.warning("모든 필드를 입력해주세요.",{position:"top-right",duration:2e3});return}const t={CREATED_DATE:new Date().toISOString().slice(0,10),RR_DATE:o.reDate,MANAGER:o.manager,RE_STATUS:"등록"},e=i.value.map(a=>({MAT_CODE:a.자재코드,RE_QTY:a.수량||0,RECEIPT_NO:a.입고번호}));await v.post("http://localhost:3000/return/request/insert",{requestData:t,detailList:e}),n.success("등록 되었습니다.",{position:"top-right",duration:1500}),h()}catch(t){console.error(t),n.error("등록 중 오류가 발생했습니다.",{position:"top-right",duration:2e3})}}const N=s({title:"불량품"}),R=U([{title:"자재",disabled:!0,href:"#"},{title:"자재반품요청서 등록 ",disabled:!1,href:"#"}]);return(t,e)=>($(),q(F,null,[l(O,{title:N.value.title,breadcrumbs:R.value},null,8,["title","breadcrumbs"]),l(w,{title:"자재반품요청서 등록"},{default:r(()=>[l(P,{ref_key:"modalRef",ref:f,title:_.value,rowData:g.value,colDefs:T.value,onConfirm:y},null,8,["title","rowData","colDefs"]),l(u,{class:"mb-4"},{default:r(()=>[l(d,{color:"warning",class:"mr-2 button",onClick:e[0]||(e[0]=a=>S("자재검수성적서 조회",V.value,b)),style:{"margin-bottom":"2rem"}},{default:r(()=>e[4]||(e[4]=[m(" 불량품 조회 ")])),_:1})]),_:1}),l(u,{class:"mb-4"},{default:r(()=>[l(c,{cols:"6"},{default:r(()=>[l(p,{label:"작성일자",modelValue:o.insertDate,"onUpdate:modelValue":e[1]||(e[1]=a=>o.insertDate=a),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),l(c,{cols:"6"},{default:r(()=>[l(p,{label:"회수요청일자",modelValue:o.reDate,"onUpdate:modelValue":e[2]||(e[2]=a=>o.reDate=a),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),l(A(I),{rowData:i.value,columnDefs:C.value,theme:A(E),style:{height:"200px",width:"100%"},onCellValueChanged:t.onCellValueChanged},null,8,["rowData","columnDefs","theme","onCellValueChanged"]),l(u,{class:"mb-4 ggg"},{default:r(()=>[l(c,{cols:"6"},{default:r(()=>[l(p,{label:"담당자",modelValue:o.manager,"onUpdate:modelValue":e[3]||(e[3]=a=>o.manager=a),outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{justify:"end"},{default:r(()=>[l(d,{color:"error",class:"mr-2",onClick:h},{default:r(()=>e[5]||(e[5]=[m("초기화")])),_:1}),l(d,{color:"primary",onClick:M},{default:r(()=>e[6]||(e[6]=[m("등록")])),_:1})]),_:1})]),_:1})],64))}},ee=L(W,[["__scopeId","data-v-a9f15f6b"]]);export{ee as default};
