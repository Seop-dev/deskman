import{O as b,P as M,_ as q,y as S,am as Z,a6 as O,a5 as Y,q as H,o as U,a as t,w as r,d as v,f as N,e as p,V as C,b as i,a0 as s,aI as D,A as z,Y as J,W as L,S as X,c as A,k as ee,j as le,T as ae,Z as te,a8 as oe,t as re,F as de,$ as x}from"./index-CGGVM91c.js";import{_ as ne,a as ie}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{B as se}from"./main-Dfa23GB-.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"card-headline"},fe={class:"head-actions"},pe={class:"grid-wrap"},k="http://localhost:3000",ce=10,ye={__name:"ProductionModify",setup(Ve){const Q=b({title:"생산계획 수정/삭제"}),P=M([{title:"생산",disabled:!0,href:"#"},{title:"생산계획 수정/삭제",disabled:!1,href:"#"}]),n=b({planNo:"",planName:"",writer:"",dueDate:""}),c=M([]);let d=null;q(()=>{y()});async function g(){try{const o=(n.value.planNo||n.value.planName||"").trim(),{data:e}=await x.get(`${k}/plans`,{params:{kw:o,page:1,size:200}});e!=null&&e.ok?(c.value=(e.rows||[]).map(a=>({id:a.id,planNo:a.planNo,productCode:a.productCode,planName:a.planName,createdDate:a.createdDate||"",writer:a.writer||"",dueDate:a.dueDate||"",totalQty:a.totalQty??0,memo:a.memo||""})),u("조회 완료")):u("조회 실패","error")}catch(o){console.error(o),u("조회 중 오류","error")}}const _=S(()=>{const o=n.value;return c.value.filter(e=>(!o.writer||(e.writer||"").includes(o.writer))&&(!o.dueDate||e.dueDate===o.dueDate))}),I=S(()=>_.value);function y(){g().then(()=>d==null?void 0:d.ensureIndexVisible(0))}function R(){n.value={planNo:"",planName:"",writer:"",dueDate:""},g().then(()=>d==null?void 0:d.ensureIndexVisible(0))}const T=Z([{headerName:"",checkboxSelection:!0,headerCheckboxSelection:!0,width:70},{headerName:"계획번호",field:"planNo",flex:1.4,minWidth:160,cellClass:"cell-ellipsis"},{headerName:"제품코드",field:"productCode",flex:.9,minWidth:110,cellClass:"cell-ellipsis"},{headerName:"계획명",field:"planName",flex:1.4,minWidth:150,cellClass:"cell-ellipsis"},{headerName:"작성일자",field:"createdDate",flex:1,minWidth:120,cellClass:"cell-ellipsis"},{headerName:"작성자",field:"writer",flex:.8,minWidth:90,cellClass:"cell-ellipsis"},{headerName:"납기일자",field:"dueDate",flex:.9,minWidth:120,cellClass:"cell-ellipsis"},{headerName:"총 수량",field:"totalQty",flex:.7,minWidth:90,cellClass:"ag-right-aligned-cell cell-ellipsis"},{headerName:"비고",field:"memo",flex:1.2,minWidth:140,cellClass:"cell-ellipsis"}]);function W(o){d=o.api,d.sizeColumnsToFit()}function B(o){return String(o.data.id)}const l=O({open:!1,dirty:!1,form:{id:null,planNo:"",productCode:"",planName:"",createdDate:"",writer:"",dueDate:"",totalQty:0,memo:""},original:null});function m(){l.dirty=!0}function $(o){const e=o==null?void 0:o.data;e&&(l.form.id=e.id,l.form.planNo=e.planNo,l.form.productCode=e.productCode,l.form.planName=e.planName,l.form.createdDate=e.createdDate,l.form.writer=e.writer,l.form.dueDate=e.dueDate,l.form.totalQty=e.totalQty,l.form.memo=e.memo,l.original={...e},l.dirty=!1,l.open=!0)}function E(){l.dirty&&!confirm("저장하지 않은 변경 사항이 있습니다. 닫을까요?")||(l.open=!1)}async function F(){if(K())try{const o=l.form.id,e={planName:l.form.planName,writer:l.form.writer,createdDate:l.form.createdDate,dueDate:l.form.dueDate,totalQty:Number(l.form.totalQty||0),productCode:l.form.productCode,memo:l.form.memo},{data:a}=await x.put(`${k}/plans/${o}`,e);if(a!=null&&a.ok){const f={...l.original,...l.form};d==null||d.applyTransactionAsync({update:[f]});const w=c.value.slice(),h=w.findIndex(G=>G.id===o);h>-1&&(w[h]=f),c.value=w,l.open=!1,l.dirty=!1,u("수정되었습니다.")}else u("수정 실패","error")}catch(o){console.error(o),u("수정 중 오류","error")}}function K(){var o,e,a;return l.form.planNo?(o=l.form.planName)!=null&&o.trim()?(e=l.form.productCode)!=null&&e.trim()?l.form.createdDate?(a=l.form.writer)!=null&&a.trim()?l.form.dueDate?!l.form.totalQty||l.form.totalQty<=0?(alert("총 수량은 1 이상이어야 합니다."),!1):!0:(alert("납기일자는 필수입니다."),!1):(alert("작성자는 필수입니다."),!1):(alert("작성일자는 필수입니다."),!1):(alert("제품코드는 필수입니다."),!1):(alert("계획명은 필수입니다."),!1):(alert("계획번호가 없습니다."),!1)}async function j(){if(!d)return;const o=d.getSelectedRows();if(!o.length){alert("삭제할 행을 선택하세요.");return}if(confirm(`${o.length}건을 삭제하시겠습니까?`))try{const e=o.map(f=>f.id),{data:a}=await x.delete(`${k}/plans`,{data:{ids:e}});if(a!=null&&a.ok){d.applyTransactionAsync({remove:o});const f=new Set(e);c.value=c.value.filter(w=>!f.has(w.id)),l.open&&l.form.id&&f.has(l.form.id)&&(l.open=!1),u("삭제되었습니다.")}else u("삭제 실패","error")}catch(e){console.error(e),u("삭제 중 오류","error")}}Y(n,()=>{d==null||d.ensureIndexVisible(0)},{deep:!0});const V=b({open:!1,msg:"",color:"primary"}),u=(o,e="primary")=>V.value={open:!0,msg:o,color:e};return(o,e)=>(U(),H(de,null,[t(ne,{title:Q.value.title,breadcrumbs:P.value},null,8,["title","breadcrumbs"]),t(ie,null,{default:r(()=>[v("div",me,[e[15]||(e[15]=v("h5",{class:"title"},"생산계획 수정/삭제",-1)),v("div",fe,[t(N,{class:"ml-4",color:"error",variant:"elevated",onClick:j},{default:r(()=>e[14]||(e[14]=[p("삭제")])),_:1})])]),t(C,{class:"mb-4",dense:""},{default:r(()=>[t(i,{cols:"3"},{default:r(()=>[t(s,{label:"계획번호",modelValue:n.value.planNo,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.planNo=a),modelModifiers:{trim:!0},dense:"",outlined:"","hide-details":"",onKeyup:D(y,["enter"])},null,8,["modelValue"])]),_:1}),t(i,{cols:"3"},{default:r(()=>[t(s,{label:"계획명",modelValue:n.value.planName,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.planName=a),modelModifiers:{trim:!0},dense:"",outlined:"","hide-details":"",onKeyup:D(y,["enter"])},null,8,["modelValue"])]),_:1}),t(i,{cols:"3"},{default:r(()=>[t(s,{label:"작성자",modelValue:n.value.writer,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.writer=a),modelModifiers:{trim:!0},dense:"",outlined:"","hide-details":"",onKeyup:D(y,["enter"])},null,8,["modelValue"])]),_:1}),t(i,{cols:"3"},{default:r(()=>[t(s,{label:"납기일자",modelValue:n.value.dueDate,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.dueDate=a),type:"date",dense:"",outlined:"","hide-details":"",onKeyup:D(y,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),t(C,{justify:"center",class:"mt-2 mb-4"},{default:r(()=>[t(i,{cols:"auto"},{default:r(()=>[t(N,{variant:"flat",color:"error",class:"mx-2",onClick:R},{default:r(()=>e[16]||(e[16]=[p("초기화")])),_:1}),t(N,{variant:"flat",color:"darkText",class:"mx-2",onClick:y},{default:r(()=>e[17]||(e[17]=[p("검색")])),_:1})]),_:1})]),_:1}),v("div",pe,[t(z(se),{class:"ag-theme-quartz ag-no-wrap",rowData:I.value,columnDefs:z(T),pagination:!0,paginationPageSize:ce,suppressPaginationPanel:!1,rowSelection:"multiple",rowMultiSelectWithClick:!0,suppressRowClickSelection:!0,immutableData:!0,getRowId:B,rowBuffer:3,onGridReady:W,onRowDoubleClicked:$},null,8,["rowData","columnDefs"])]),t(J,{modelValue:l.open,"onUpdate:modelValue":e[12]||(e[12]=a=>l.open=a),"max-width":"760",persistent:""},{default:r(()=>[t(L,null,{default:r(()=>[t(X,{class:"d-flex align-center justify-space-between"},{default:r(()=>[e[19]||(e[19]=v("span",null,"생산계획 수정",-1)),l.dirty?(U(),A(le,{key:0,size:"small",color:"warning",variant:"tonal"},{default:r(()=>e[18]||(e[18]=[p("변경됨")])),_:1})):ee("",!0)]),_:1}),t(ae,null,{default:r(()=>[t(C,null,{default:r(()=>[t(i,{cols:"6",md:"4"},{default:r(()=>[t(s,{label:"계획번호",modelValue:l.form.planNo,"onUpdate:modelValue":e[4]||(e[4]=a=>l.form.planNo=a),readonly:"",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(i,{cols:"6",md:"8"},{default:r(()=>[t(s,{label:"계획명",modelValue:l.form.planName,"onUpdate:modelValue":[e[5]||(e[5]=a=>l.form.planName=a),m],modelModifiers:{lazy:!0},density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(i,{cols:"6",md:"4"},{default:r(()=>[t(s,{label:"제품코드",modelValue:l.form.productCode,"onUpdate:modelValue":[e[6]||(e[6]=a=>l.form.productCode=a),m],modelModifiers:{lazy:!0},density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(i,{cols:"6",md:"4"},{default:r(()=>[t(s,{label:"작성일자",modelValue:l.form.createdDate,"onUpdate:modelValue":[e[7]||(e[7]=a=>l.form.createdDate=a),m],modelModifiers:{lazy:!0},type:"date",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(i,{cols:"6",md:"4"},{default:r(()=>[t(s,{label:"작성자",modelValue:l.form.writer,"onUpdate:modelValue":[e[8]||(e[8]=a=>l.form.writer=a),m],modelModifiers:{lazy:!0},density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(i,{cols:"6",md:"4"},{default:r(()=>[t(s,{label:"납기일자",modelValue:l.form.dueDate,"onUpdate:modelValue":[e[9]||(e[9]=a=>l.form.dueDate=a),m],modelModifiers:{lazy:!0},type:"date",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(i,{cols:"6",md:"4"},{default:r(()=>[t(s,{label:"총 수량",modelValue:l.form.totalQty,"onUpdate:modelValue":[e[10]||(e[10]=a=>l.form.totalQty=a),m],modelModifiers:{number:!0,lazy:!0},type:"number",min:"0",step:"1",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(i,{cols:"12"},{default:r(()=>[t(s,{label:"비고",modelValue:l.form.memo,"onUpdate:modelValue":[e[11]||(e[11]=a=>l.form.memo=a),m],modelModifiers:{lazy:!0},placeholder:"메모를 입력하세요",density:"compact",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(te,{class:"justify-end"},{default:r(()=>[t(N,{variant:"flat",color:"darkText",onClick:E},{default:r(()=>e[20]||(e[20]=[p("닫기")])),_:1}),t(N,{variant:"flat",color:"success",onClick:F},{default:r(()=>e[21]||(e[21]=[p("수정")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(oe,{modelValue:V.value.open,"onUpdate:modelValue":e[13]||(e[13]=a=>V.value.open=a),color:V.value.color,timeout:2e3},{default:r(()=>[p(re(V.value.msg),1)]),_:1},8,["modelValue","color"])]),_:1})],64))}},be=ue(ye,[["__scopeId","data-v-e181ab04"]]);export{be as default};
