import{_ as H,a as J}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{O as s,P as X,_ as Z,$ as i,q as ee,o as ae,a as t,w as r,d as u,a0 as c,f as m,e as f,A as v,a1 as te,V as R,b as w,F as le}from"./index-CGGVM91c.js";import{B as M}from"./main-Dfa23GB-.js";import{_ as oe}from"./NewModal-RG6-e5WE.js";import{d as se}from"./theme-bootstrap-maRaUoWN.js";import{u as re}from"./auth-B63OrgMx.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"d-flex align-center mb-4"},ne={class:"main-container"},ue={class:"list-container"},ce={class:"form-wrapper"},me={__name:"MasterDiagram",setup(fe){var k;const d=se.useToast(),E=re(),P=te,l=s({product:"",diagram:"",writer:((k=E.user)==null?void 0:k.name)||"",addDate:new Date().toISOString().split("T")[0]}),h=s(null),b=s(null),N=a=>h.value=a.api,S=a=>b.value=a.api,C=s([]),I=s([{headerCheckboxSelection:!0,checkboxSelection:!0,width:50},{field:"제품명",editable:!0,width:120},{field:"제품코드",width:130},{field:"제품유형",width:130},{field:"공정흐름도",width:130},{field:"작성자",width:110,editable:!0},{field:"등록일",width:110,editable:!0}]),p=s([]),F=s([{headerCheckboxSelection:!0,checkboxSelection:!0,width:50},{field:"공정순서",type:Number,flex:1,rowDrag:!0,editable:!0},{field:"공정코드",editable:!0,flex:1},{field:"공정명",flex:1},{field:"설비유형",flex:1}]),$=s({title:"공정흐름도 관리"}),B=X([{title:"기준정보",disabled:!0,href:"#"},{title:"공정흐름도 관리",disabled:!1,href:"#"}]),x=s(null),V=s(""),y=s([]),A=s([]),L=[{field:"공정코드",headerName:"공정코드",flex:1},{field:"공정명",headerName:"공정명",flex:1},{field:"설비유형",headerName:"설비유형",flex:1},{field:"등록일자",headerName:"등록일자",flex:1}],T=s([]);Z(()=>{_(),z()});const _=async()=>{const a=await i.get("http://localhost:3000/diaPrdList");C.value=a.data.map(e=>({제품명:e.PRD_NAME,제품코드:e.PRD_CODE,제품유형:e.PRD_TYPE,공정흐름도:e.DIA_CODE,작성자:e.PRD_WRITER,등록일:e.PRD_DATE.substring(0,10)}))},D=async()=>{if(!l.value.diagram)return;const a=await i.post("http://localhost:3000/prcList",{DIA_CODE:l.value.diagram});p.value=a.data.map(e=>({공정순서:e.PRC_ORDER,공정코드:e.PRC_CODE,공정명:e.PRC_NAME,설비유형:e.FAC_TYPE}))},U=a=>{l.value.product=a.data.제품명,l.value.diagram=a.data.공정흐름도,l.value.writer=a.data.작성자,l.value.addDate=a.data.등록일,D()},Y=async()=>{const a=b.value.getSelectedRows();if(!a.length){d.error("제품을 선택하세요",{position:"top-right",duration:1e3});return}const e=a.find(n=>n.공정흐름도);if(e){d.error(`이미 공정흐름도 코드가 부여된 제품입니다: ${e.제품명}`,{position:"top-right",duration:1e3});return}const o=a.map(n=>n.제품코드);await i.post("http://localhost:3000/diaInsert",{제품코드:o,작성자:l.value.writer,등록일:l.value.addDate}),d.success("등록 성공",{position:"top-right",duration:1e3}),_()},G=()=>{var a;l.value={product:"",diagram:"",writer:((a=E.user)==null?void 0:a.name)||"",addDate:new Date().toISOString().split("T")[0]},p.value=[],_()},j=async()=>{const a=h.value.getSelectedRows();if(!a.length){d.error("삭제할 공정을 선택하세요.",{position:"top-right",duration:1e3});return}if(!confirm("공정을 삭제하시겠습니까?"))return;const e=a.map(o=>o.공정코드);await i.post("http://localhost:3000/prcDelete",{diaCode:l.value.diagram,prcCode:e}),D()},q=async()=>{const a=[];h.value.forEachNode((e,o)=>{a.push({DIA_CODE:l.value.diagram,PRC_CODE:e.data.공정코드,PRC_ORDER:o+1})}),await i.post("http://localhost:3000/updateProcessOrder",a),D()},z=async()=>{const a=await i.get("http://localhost:3000/diaModalList");T.value=a.data.map(e=>({공정코드:e.PRC_CODE,공정명:e.PRC_NAME,설비유형:e.FAC_TYPE,등록일자:e.PRC_RDATE?e.PRC_RDATE.substring(0,10):null}))},W=(a,e,o)=>{var n;if(!l.value.product){d.error("제품이 선택되지 않았습니다",{position:"top-right",duration:1e3});return}V.value=a,y.value=e,A.value=o,(n=x.value)==null||n.open()},K=async a=>{if(p.value.find(e=>e.공정코드===a.공정코드)){d.info("등록된 공정입니다.",{position:"top-right",duration:1e3});return}await i.post("http://localhost:3000/prcModalConfirm",{DIA_CODE:l.value.diagram,PRC_CODE:a.공정코드,PRC_NAME:a.공정명,FAC_TYPE:a.설비유형}),D()},O=a=>console.log(a.value),g=s(""),Q=async()=>{const a=await i.post("http://localhost:3000/diaPrdSearch",{PRD_NAME:g.value});C.value=a.data.map(e=>({제품명:e.PRD_NAME,제품코드:e.PRD_CODE,제품유형:e.PRD_TYPE,공정흐름도:e.DIA_CODE,작성자:e.PRD_WRITER,등록일:e.PRD_DATE.substring(0,10)})),d.success("검색이 완료되었습니다.",{position:"top-right",duration:1e3})};return(a,e)=>(ae(),ee(le,null,[t(H,{title:$.value.title,breadcrumbs:B.value},null,8,["title","breadcrumbs"]),t(J,{title:"제품 목록"},{default:r(()=>[u("div",de,[t(c,{label:"제품 검색",modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o),"hide-details":"",class:"mr-2",style:{"max-width":"280px"}},null,8,["modelValue"]),t(m,{color:"darkText",onClick:Q},{default:r(()=>e[6]||(e[6]=[f("검색")])),_:1})]),u("div",ne,[u("div",ue,[t(v(M),{rowData:C.value,columnDefs:I.value,theme:v(P),style:{height:"500px",width:"100%"},onCellValueChanged:O,rowSelection:"single",onRowClicked:U,onGridReady:S},null,8,["rowData","columnDefs","theme"])]),u("div",ce,[t(R,{class:"mb-4"},{default:r(()=>[t(w,{cols:"6"},{default:r(()=>[t(c,{label:"제품명",modelValue:l.value.product,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.product=o),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(w,{cols:"6"},{default:r(()=>[t(c,{label:"공정흐름도 코드",modelValue:l.value.diagram,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.diagram=o),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(w,{cols:"6"},{default:r(()=>[t(c,{label:"작성자",modelValue:l.value.writer,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.writer=o),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(w,{cols:"6"},{default:r(()=>[t(c,{label:"등록일",modelValue:l.value.addDate,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.addDate=o),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(R,{justify:"center"},{default:r(()=>[t(m,{color:"error",class:"mr-3",onClick:G},{default:r(()=>e[7]||(e[7]=[f("초기화")])),_:1}),t(m,{color:"primary",class:"mr-6",onClick:Y},{default:r(()=>e[8]||(e[8]=[f("등록")])),_:1})]),_:1})]),_:1}),e[11]||(e[11]=u("h5",null,"공정목록",-1)),t(R,{justify:"end",class:"mb-4"},{default:r(()=>[t(m,{color:"warning",class:"mr-4",onClick:e[5]||(e[5]=o=>W("공정 조회",T.value,L))},{default:r(()=>e[9]||(e[9]=[f(" 공정 조회 ")])),_:1}),t(m,{color:"error",class:"mr-4",onClick:j},{default:r(()=>e[10]||(e[10]=[f("삭제")])),_:1})]),_:1}),t(oe,{ref_key:"modalRef",ref:x,title:V.value,rowData:y.value,colDefs:A.value,onConfirm:K},null,8,["title","rowData","colDefs"]),t(v(M),{rowData:p.value,columnDefs:F.value,theme:v(P),style:{height:"250px",width:"100%"},onCellValueChanged:O,rowDragManaged:!0,animateRows:!0,rowSelection:"multiple",onGridReady:N,onRowDragEnd:q},null,8,["rowData","columnDefs","theme"])])])]),_:1})],64))}},ge=ie(me,[["__scopeId","data-v-40bd702f"]]);export{ge as default};
