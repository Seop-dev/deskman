import{_ as Z,a as G}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{O as n,_ as j,P as q,$ as d,q as K,o as H,a as o,w as s,d as m,a0 as r,f as p,e as T,V as A,A as D,a1 as J,b as u,a2 as R,F as X}from"./index-CGGVM91c.js";import{B as ee}from"./main-Dfa23GB-.js";import{_ as ae}from"./NewModal-RG6-e5WE.js";import{d as te}from"./theme-bootstrap-maRaUoWN.js";import{u as le}from"./auth-B63OrgMx.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"d-flex align-center mb-4"},ne={class:"main-container"},ie={class:"list-container"},ue={class:"form-wrapper"},de={class:"add"},re={__name:"MasterMaterials",setup(me){var N;const i=te.useToast(),w=le(),x=J,y=new Date().toISOString().split("T")[0],a=n({matCode:"",matName:"",writer:((N=w.user)==null?void 0:N.name)||"",date:y,size:"",safeQT:"",unit:"",type:"",note:""});j(()=>{c(),B(),O(),k()});const f=n([]),S=n([{checkboxSelection:!0,width:50},{field:"자재코드",width:140},{field:"자재명",width:140},{field:"자재유형",width:140},{field:"규격",width:140},{field:"안전재고",width:130},{field:"단위",width:130},{field:"작성자",width:130},{field:"등록일자",width:130},{field:"비고",width:130}]),U=n({title:"자재 관리"}),I=q([{title:"기준정보",disabled:!0,href:"#"},{title:"자재 관리",disabled:!1,href:"#"}]),Q=t=>{console.log(t.value),console.log(f.value)},c=async()=>{const t=await d.get("http://localhost:3000/masterMatSelect");f.value=t.data.map(e=>({자재코드:e.MAT_CODE,자재명:e.MAT_NAME,자재유형:e.MAT_TYPE,규격:e.MAT_SIZE,단위:e.MAT_UNIT,안전재고:e.MAT_SAFEQT,작성자:e.MAT_WRITER,등록일자:e.MAT_DATE.substring(0,10),비고:e.MAT_NOTE}))},V=n([]),g=n([]),k=async()=>{const t=await d.get("http://localhost:3000/masterMatUnit");V.value=t.data.map(e=>e.code_name)},O=async()=>{const t=await d.get("http://localhost:3000/masterMatType");g.value=t.data.map(e=>e.code_name)},z=async()=>{try{if(a.value.matCode){const t={MAT_NAME:a.value.matName,MAT_TYPE:a.value.type,MAT_UNIT:a.value.unit,MAT_SIZE:a.value.size,MAT_SAFEQT:a.value.safeQT,MAT_WRITER:a.value.writer,MAT_DATE:a.value.date,MAT_NOTE:a.value.note,MAT_CODE:a.value.matCode};await d.post("http://localhost:3000/masterMatUpdate",t),i.success("자재가 수정되었습니다.",{position:"top-right",duration:1e3})}else{const t=f.value.some(l=>l.자재명===a.value.matName);if(!a.value.matCode&&t){i.warning("이미 등록된 자재입니다.",{position:"top-right",duration:1e3});return}if(!a.value.safeQT||!a.value.type){i.warning("값을 올바르게 기재하십시오.",{position:"top-right",duration:1e3});return}const e={MAT_NAME:a.value.matName,MAT_TYPE:a.value.type,MAT_UNIT:a.value.unit,MAT_SIZE:a.value.size,MAT_SAFEQT:a.value.safeQT,MAT_WRITER:a.value.writer,MAT_DATE:a.value.date,MAT_NOTE:a.value.note};await d.post("http://localhost:3000/masterMatInsert",e),i.success("자재가 등록되었습니다.",{position:"top-right",duration:1e3})}c(),_()}catch(t){i.error("저장 중 오류가 발생했습니다.",{position:"top-right",duration:1e3}),console.error(t)}},_=()=>{var t;a.value={matCode:"",matName:"",writer:((t=w.user)==null?void 0:t.name)||"",date:y,size:"",safeQT:"",unit:"",type:"",note:""},c()},F=t=>{a.value.matCode=t.data.자재코드,a.value.matName=t.data.자재명,a.value.writer=t.data.작성자,a.value.date=t.data.등록일자,a.value.safeQT=t.data.안전재고,a.value.size=t.data.규격,a.value.unit=t.data.단위,a.value.type=t.data.자재유형,a.value.note=t.data.비고},M=n(null),h=n(""),E=n([]),C=n([]),$=[{field:"그룹코드",headerName:"그룹코드",flex:1},{field:"규격",headerName:"규격",flex:1},{field:"사용유무",headerName:"사용유무",flex:1}],b=n([]),B=async()=>{const t=await d.get("http://localhost:3000/masterMatModal");b.value=t.data.map(e=>({그룹코드:e.group_code,규격:e.code_name,사용유무:e.use_yn}))},P=async(t,e,l)=>{h.value=t,E.value=e,C.value=l,M.value&&M.value.open()},L=async t=>{a.value.size=t.규격,i.info(`규격 [${t.규격}] 선택됨`,{position:"top-right",duration:1e3})},W=async()=>{if(!a.value.matCode){i.warning("삭제할 자재를 선택하세요.",{position:"top-right",duration:1e3});return}try{await d.post("http://localhost:3000/masterMatDelete",{MAT_CODE:a.value.matCode}),i.success(`${a.value.matName}(이)가 삭제되었습니다.`,{position:"top-right",duration:1e3}),c(),_()}catch{i.error("삭제 중 오류가 발생했습니다.",{position:"top-right",duration:1e3})}},v=n(""),Y=async()=>{if(!v.value){i.warning("자재가 입력되지 않았습니다",{position:"top-right",duration:1e3});return}const t={MAT_NAME:v.value},e=await d.post("http://localhost:3000/masterMatSearch",t);f.value=e.data.map(l=>({자재코드:l.MAT_CODE,자재명:l.MAT_NAME,자재유형:l.MAT_TYPE,규격:l.MAT_SIZE,단위:l.MAT_UNIT,안전재고:l.MAT_SAFEQT,작성자:l.MAT_WRITER,등록일자:l.MAT_DATE.substring(0,10),비고:l.MAT_NOTE})),i.success("검색이 완료되었습니다.",{position:"top-right",duration:1e3})};return(t,e)=>(H(),K(X,null,[o(Z,{title:U.value.title,breadcrumbs:I.value},null,8,["title","breadcrumbs"]),o(G,{title:"자재 목록"},{default:s(()=>[m("div",se,[o(r,{label:"자재 검색",modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),"hide-details":"",class:"mr-2",style:{"max-width":"280px"}},null,8,["modelValue"]),o(p,{color:"darkText",onClick:Y},{default:s(()=>e[11]||(e[11]=[T("검색")])),_:1}),o(A,{justify:"end",class:"mr-3"},{default:s(()=>[o(p,{color:"error",class:"mr-1",onClick:W},{default:s(()=>e[12]||(e[12]=[T("삭제")])),_:1})]),_:1})]),m("div",ne,[m("div",ie,[o(D(ee),{rowData:f.value,columnDefs:S.value,theme:D(x),style:{height:"500px",width:"100%"},onCellValueChanged:Q,rowSelection:"single",onRowClicked:F,onGridReady:t.onGridReadyMat},null,8,["rowData","columnDefs","theme","onGridReady"])]),m("div",ue,[m("div",de,[o(A,{class:"mb-4"},{default:s(()=>[o(u,{cols:"6"},{default:s(()=>[o(r,{label:"자재코드",modelValue:a.value.matCode,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.matCode=l),readonly:"true",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(u,{cols:"6"},{default:s(()=>[o(r,{label:"자재명",modelValue:a.value.matName,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.matName=l),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(u,{cols:"6"},{default:s(()=>[o(r,{label:"작성자",modelValue:a.value.writer,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.writer=l),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(u,{cols:"6"},{default:s(()=>[o(r,{label:"등록일자",modelValue:a.value.date,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.date=l),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(u,{cols:"6"},{default:s(()=>[o(r,{label:"규격",modelValue:a.value.size,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.size=l),placeholder:"규격",dense:"",outlined:"",readonly:""},{"append-inner":s(()=>[m("i",{class:"fa-solid fa-magnifying-glass",style:{cursor:"pointer","font-size":"large","margin-right":"0.5rem"},onClick:e[5]||(e[5]=l=>P("자재 규격 조회",b.value,$))})]),_:1},8,["modelValue"]),o(ae,{ref_key:"modalRef",ref:M,title:h.value,rowData:E.value,colDefs:C.value,onConfirm:L},null,8,["title","rowData","colDefs"])]),_:1}),o(u,{cols:"6"},{default:s(()=>[o(r,{label:"안전재고",modelValue:a.value.safeQT,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.safeQT=l),type:"number",min:"0",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(u,{cols:"6"},{default:s(()=>[o(R,{label:"단위",modelValue:a.value.unit,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.unit=l),items:V.value,dense:"",outlined:""},null,8,["modelValue","items"])]),_:1}),o(u,{cols:"6"},{default:s(()=>[o(R,{label:"자재유형",modelValue:a.value.type,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.type=l),items:g.value,dense:"",outlined:""},null,8,["modelValue","items"])]),_:1}),o(u,{cols:"12"},{default:s(()=>[o(r,{label:"비고",modelValue:a.value.note,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.note=l),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(A,{justify:"center"},{default:s(()=>[o(p,{color:"error",class:"mr-3",onClick:_},{default:s(()=>e[13]||(e[13]=[T("초기화")])),_:1}),o(p,{color:"primary",class:"mr-6",onClick:z},{default:s(()=>e[14]||(e[14]=[T("저장")])),_:1})]),_:1})]),_:1})]),e[15]||(e[15]=m("br",null,null,-1))])])]),_:1})],64))}},Ae=oe(re,[["__scopeId","data-v-8e082bf8"]]);export{Ae as default};
