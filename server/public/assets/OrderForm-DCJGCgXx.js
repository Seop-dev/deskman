import{O as n,P as oe,a5 as ae,_ as ne,$ as c,q as ie,o as re,a as o,w as r,d as s,V as D,b as f,a0 as m,A as w,f as y,e as _,a1 as se,F as ue}from"./index-CGGVM91c.js";import{B as de}from"./main-Dfa23GB-.js";import{_ as U}from"./NewModal-RG6-e5WE.js";import{_ as ce,a as fe}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{d as me}from"./theme-bootstrap-maRaUoWN.js";import{u as pe}from"./auth-B63OrgMx.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";const De={class:"main-container"},we={class:"list-container"},ye={class:"add"},_e={__name:"OrderForm",setup(ge){var T;const i=me.useToast(),g=pe(),q=n({mode:"multiRow"}),l=n({dDay:"",rDay:"",writer:((T=g.user)==null?void 0:T.name)||"",client:"",client_code:""}),$=oe([{title:"영업",disabled:!0,href:"#"},{title:"주문서",disabled:!0,href:"#"},{title:"주문서 등록",disabled:!1,href:"#"}]),Q=n({title:"주문서 등록"}),B=se,F=new Date().toISOString().split("T")[0],R=n(null),O=n(null);ae(R,t=>{l.value.client=(t==null?void 0:t.cusName)??""}),ne(()=>{L(),J()});const C=n(null),G=t=>{C.value=t.api},Y=n([{field:"제품코드",flex:1},{field:"제품명",flex:1},{field:"제품유형",flex:1},{field:"규격",flex:1},{field:"주문수량",flex:1,editable:!0,cellDataType:"number"},{field:"단위",flex:1}]),d=n([]),j=t=>{if(t.colDef.field==="주문수량"){const e=Number(String(t.newValue).toString().replaceAll(",",""));!Number.isFinite(e)||e<=0?(t.data.주문수량=1,t.api.applyTransaction({update:[t.data]}),i.warning("수량은 1 이상이어야 합니다.")):(t.data.주문수량=e,t.api.applyTransaction({update:[t.data]}))}},p=n(null),h=n(""),b=n([]),x=n([]),z=[{field:"거래처코드",headerName:"거래처코드",flex:1},{field:"거래처명",headerName:"거래처명",flex:1},{field:"거래담당자",headerName:"거래담당자",flex:1}],V=n([]),L=async()=>{try{const t=await c.get("http://localhost:3000/reqCusModal");V.value=t.data.map(e=>({거래처코드:e.CUS_ID,거래처명:e.CUS_NAME,거래담당자:e.CUS_MANAGER}))}catch(t){console.error(t),i.error("거래처 데이터를 불러오지 못했습니다.",{position:"top-right",duration:1e3})}},W=async(t,e,a)=>{h.value=t,b.value=e,x.value=a,p.value&&p.value.open()},Z=t=>{l.value.client=t.거래처명,l.value.client_code=t.거래처코드},v=n(null),N=n(""),M=n([]),S=n([]),H=[{field:"제품코드",headerName:"제품코드",flex:1},{field:"제품명",headerName:"제품명",flex:1},{field:"제품유형",headerName:"제품유형",flex:1},{field:"규격",headerName:"규격",flex:1},{field:"단위",headerName:"단위",flex:1}],E=n([]),J=async()=>{try{const t=await c.get("http://localhost:3000/reqPrdModal");E.value=t.data.map(e=>({제품코드:e.PRD_CODE,제품명:e.PRD_NAME,제품유형:e.PRD_TYPE,규격:e.PRD_SIZE,단위:e.PRD_UNIT}))}catch(t){console.error(t),i.error("제품 데이터를 불러오지 못했습니다.",{position:"top-right",duration:1e3})}},K=async(t,e,a)=>{N.value=t,S.value=a,M.value=e,v.value&&v.value.open()},X=t=>{if(d.value.some(a=>a.제품코드===t.제품코드)){i.info("이미 추가된 제품입니다.",{position:"top-right",duration:1e3});return}d.value.unshift(t),i.success("제품이 추가되었습니다.",{position:"top-right",duration:1e3})},ee=()=>{var t;l.value={client:"",dDay:"",rDay:"",writer:((t=g.user)==null?void 0:t.name)||""},d.value=[],R.value=null,O.value=null,i.info("입력값이 초기화되었습니다.",{position:"top-right",duration:1e3})},te=async()=>{var a,I;if(!l.value.client||!l.value.dDay){i.warning("거래처와 납기일을 확인하세요.",{position:"top-right",duration:1e3});return}const t=C.value.getSelectedRows();if(t.length===0){i.warning("등록할 제품을 선택하세요.",{position:"top-right",duration:1e3});return}if(t.some(u=>!u.주문수량||u.주문수량<=0)){i.warning("모든 제품의 수량을 입력해주세요.",{position:"top-right",duration:1e3});return}try{const u={CUS_ID:l.value.client_code,REQ_DATE:l.value.rDay,REQ_DDAY:l.value.dDay,WRITER:l.value.writer},k=await c.post("http://localhost:3000/reqInsert",u);if(!((a=k.data)!=null&&a.success)){i.error("주문서(헤더) 등록 실패",{position:"top-right",duration:1e3});return}const A=k.data.reqId,le={reqId:A,rows:t.map(P=>({REQ_QTY:Number(P.주문수량),PRD_CODE:P.제품코드}))};if(!((I=(await c.post("http://localhost:3000/reqDetailInsert",le)).data)!=null&&I.success)){i.error("주문서(상세) 등록 실패",{position:"top-right",duration:1e3});return}i.success(`주문서 등록완료 (번호: ${A})`,{position:"top-right",duration:1e3}),l.value={dDay:"",rDay:"",writer:"",client:"",client_code:""},d.value=[]}catch(u){console.error(u),i.error("주문서 등록 중 오류가 발생했습니다.",{position:"top-right",duration:1e3})}};return(t,e)=>(re(),ie(ue,null,[o(ce,{title:Q.value.title,breadcrumbs:$.value},null,8,["title","breadcrumbs"]),o(fe,{title:"주문서 등록"},{default:r(()=>[s("div",De,[s("div",we,[s("div",ye,[o(D,{class:"mb-4"},{default:r(()=>[o(f,{cols:"6"},{default:r(()=>[o(m,{label:"거래처명",modelValue:l.value.client,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.client=a),outlined:"",readonly:"",onClick:e[1]||(e[1]=a=>W("거래처 조회",V.value,z))},null,8,["modelValue"])]),_:1}),o(U,{ref_key:"modalRef",ref:p,title:h.value,rowData:b.value,colDefs:x.value,onConfirm:Z},null,8,["title","rowData","colDefs"]),o(f,{cols:"6"},{default:r(()=>[o(m,{label:"주문일자",modelValue:l.value.rDay,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.rDay=a),type:"date",outlined:""},null,8,["modelValue"])]),_:1}),o(f,{cols:"6"},{default:r(()=>[o(m,{label:"납기일자",modelValue:l.value.dDay,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.dDay=a),type:"date",min:w(F),outlined:""},null,8,["modelValue","min"])]),_:1}),o(f,{cols:"6"},{default:r(()=>[o(m,{label:"작성자",modelValue:l.value.writer,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.writer=a),outlined:""},null,8,["modelValue"])]),_:1})]),_:1})]),o(D,{justify:"end"},{default:r(()=>[o(y,{color:"warning",class:"mr-6",onClick:e[5]||(e[5]=a=>K("제품 조회",E.value,H))},{default:r(()=>e[6]||(e[6]=[_("제품 추가")])),_:1})]),_:1}),e[9]||(e[9]=s("br",null,null,-1)),e[10]||(e[10]=s("br",null,null,-1)),o(w(de),{columnDefs:Y.value,rowData:d.value,theme:w(B),style:{height:"300px",width:"100%"},onCellValueChanged:j,rowSelection:q.value,onRowClicked:t.onRowClicked,onGridReady:G},null,8,["columnDefs","rowData","theme","rowSelection","onRowClicked"]),e[11]||(e[11]=s("br",null,null,-1)),e[12]||(e[12]=s("br",null,null,-1)),o(D,{justify:"end"},{default:r(()=>[o(y,{color:"error",class:"mr-6",onClick:ee},{default:r(()=>e[7]||(e[7]=[_("초기화")])),_:1}),o(y,{color:"primary",class:"mr-6",onClick:te},{default:r(()=>e[8]||(e[8]=[_("등록")])),_:1})]),_:1})])]),o(U,{ref_key:"itemModalRef",ref:v,title:N.value,rowData:M.value,colDefs:S.value,onConfirm:X},null,8,["title","rowData","colDefs"])]),_:1})],64))}},Se=ve(_e,[["__scopeId","data-v-b76a09c1"]]);export{Se as default};
