import{_ as y,a as I}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{B as U}from"./main-Dfa23GB-.js";import{O as s,_ as R,$ as m,a6 as Y,P as k,q as $,o as Q,a as o,w as r,V as d,b as u,a0 as f,f as p,e as b,a2 as B,A as C,a1 as F,F as W}from"./index-CGGVM91c.js";import{_ as L}from"./NewModal-RG6-e5WE.js";import{u as q}from"./auth-B63OrgMx.js";import{d as z}from"./theme-bootstrap-maRaUoWN.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={__name:"MaterialInsert",setup(Z){var E;const i=z.useToast(),_=q(),v=F,T=s([]);R(()=>{w()});const w=async()=>{try{const e=await m.get("http://localhost:3000/wrNameSelect");T.value=e.data.map(l=>l.WR_NAME)}catch(e){console.error("공통코드 데이터를 불러오는 데 실패했습니다:",e)}},n=s([]),A=s([{field:"자재명",flex:1},{field:"자재코드",flex:1},{field:"규격",flex:1},{field:"단위",flex:1},{field:"발주수량",flex:1},{field:"업데이트수량",headerName:"현재 입고된 수량",flex:1},{field:"입고수량",headerName:"입고할 수량",editable:!0,flex:1}]),a=Y({issueNumber:"",insertDate:new Date().toISOString().substring(0,10),name:"",manager:((E=_.user)==null?void 0:E.name)||"",wrName:""}),c=s(null),g=s(""),N=s([]),D=s([]),V=[{field:"발행번호",headerName:"발행번호",flex:1.5},{field:"업체",headerName:"공급업체",flex:1},{field:"자재코드",headerName:"자재코드",flex:1},{field:"자재명",headerName:"자재명",flex:1},{field:"발주수량",headerName:"발주수량",flex:1},{field:"상태",headerName:"상태",flex:.8,cellStyle:e=>e.value==="대기"?{color:"black",fontWeight:"bold"}:e.value==="진행중"?{color:"blue",fontWeight:"bold"}:e.value=="완료"?{color:"red",fontWeight:"bold"}:null}],x=async e=>{g.value=e,D.value=V;const l=await m.get("http://localhost:3000/materials/order/select");N.value=l.data.filter(t=>t.PO_STATUS!=="완료").map(t=>({발행번호:t.PO_NO,업체:t.SUPPLYER,자재코드:t.MAT_CODE,자재명:t.MAT_NAME,발주수량:t.RECEIPT_QTY,상태:t.PO_STATUS,규격:t.MAT_SIZE,단위:t.MAT_UNIT,업데이트수량:t.UPDATE_QTY,자재유형:t.MAT_TYPE})),c.value&&c.value.open()};function S(e){a.issueNumber=e.발행번호||"",a.name=e.업체||"";const l=new Date;a.insertDate=l.toISOString().slice(0,10),n.value.push({자재명:e.자재명||"",자재코드:e.자재코드||"",규격:e.규격||"",단위:e.단위||"",발주수량:e.발주수량||0,업데이트수량:e.업데이트수량||0,자재유형:e.자재유형||""})}function h(){var e;a.issueNumber="",a.insertDate=new Date().toISOString().substring(0,10),a.manager="",a.name=((e=_.user)==null?void 0:e.name)||"",a.wrName="",n.value=[]}async function M(){try{if(!a.issueNumber||!a.insertDate||!a.manager||!a.name||!a.wrName){i.warning("모든 필드를 입력해주세요.",{position:"top-right",duration:2e3});return}for(const e of n.value)if((e.입고수량||0)>(e.발주수량||0)-(e.업데이트수량||0)){i.warning(`자재 "${e.자재명}"의 입고수량이 발주수량보다 많을 수 없습니다.`,{position:"top-right",duration:2500});return}for(const e of n.value){const l=e.자재유형=="원자재"?"검수 대기":"완료";await m.post("http://localhost:3000/materialInsert",{PO_NO:a.issueNumber,RECEIPT_DATE:a.insertDate,SUPPLYER:a.name,MANAGER:a.manager,MAT_CODE:e.자재코드,RECEIPT_QTY:e.발주수량,RECEIVED_QTY:e.입고수량,TMP_STATUS:l}),e.자재유형&&e.자재유형!=="원자재"&&await m.post("http://localhost:3000/LOTInsert",{MAT_CODE:e.자재코드,MANAGER:a.manager,MAT_QTY:e.입고수량,RECEIPT_NO:e.입고번호})}i.success("등록 되었습니다.",{position:"top-right",duration:1e3}),h()}catch(e){console.error(e),i.error("등록 중 오류가 발생했습니다: "+e,{position:"top-right",duration:2e3})}}const O=s({title:"입고"}),P=k([{title:"자재",disabled:!0,href:"#"},{title:"입고 등록 ",disabled:!1,href:"#"}]);return(e,l)=>(Q(),$(W,null,[o(y,{title:O.value.title,breadcrumbs:P.value},null,8,["title","breadcrumbs"]),o(I,{title:"자재 입고"},{default:r(()=>[o(d,{class:"mb-4"},{default:r(()=>[o(u,{cols:"4"},{default:r(()=>[o(f,{label:"발행번호",modelValue:a.issueNumber,"onUpdate:modelValue":l[0]||(l[0]=t=>a.issueNumber=t),dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),_:1}),o(p,{color:"warning",class:"mr-2 button",onClick:l[1]||(l[1]=t=>x("자재발주서 조회",e.materialRowData,V)),style:{"margin-bottom":"2rem"}},{default:r(()=>l[6]||(l[6]=[b(" 자재발주서 조회 ")])),_:1}),o(L,{ref_key:"modalRef",ref:c,title:g.value,rowData:N.value,colDefs:D.value,onConfirm:S},null,8,["title","rowData","colDefs"]),o(u,{cols:"4"},{default:r(()=>[o(B,{label:"창고명",class:"select",modelValue:a.wrName,"onUpdate:modelValue":l[2]||(l[2]=t=>a.wrName=t),items:T.value,dense:"",outlined:""},null,8,["modelValue","items"])]),_:1})]),_:1}),o(d,{class:"mb-4"},{default:r(()=>[o(u,{cols:"6"},{default:r(()=>[o(f,{label:"입고일자",modelValue:a.insertDate,"onUpdate:modelValue":l[3]||(l[3]=t=>a.insertDate=t),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(u,{cols:"6"},{default:r(()=>[o(f,{label:"업체명",modelValue:a.name,"onUpdate:modelValue":l[4]||(l[4]=t=>a.name=t),dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),o(C(U),{rowData:n.value,columnDefs:A.value,theme:C(v),style:{height:"200px",width:"100%"},onCellValueChanged:e.onCellValueChanged},null,8,["rowData","columnDefs","theme","onCellValueChanged"]),o(d,{class:"mb-4 margin"},{default:r(()=>[o(u,{cols:"6"},{default:r(()=>[o(f,{label:"담당자",modelValue:a.manager,"onUpdate:modelValue":l[5]||(l[5]=t=>a.manager=t),outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),o(d,{justify:"end"},{default:r(()=>[o(p,{color:"error",class:"mr-2",onClick:h},{default:r(()=>l[7]||(l[7]=[b("초기화")])),_:1}),o(p,{color:"primary",onClick:M},{default:r(()=>l[8]||(l[8]=[b("등록")])),_:1})]),_:1})]),_:1})],64))}},te=G(j,[["__scopeId","data-v-b66f5798"]]);export{te as default};
