import{_ as B,a as W}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{O as n,P as Y,_ as z,$ as c,q as j,o as q,a as l,w as s,d as u,a0 as i,f as v,e as C,V as w,A as D,a1 as L,b as d,F as K}from"./index-CGGVM91c.js";import{B as Q}from"./main-Dfa23GB-.js";import{_ as G}from"./NewModal-RG6-e5WE.js";import{d as H}from"./theme-bootstrap-maRaUoWN.js";import{u as J}from"./auth-B63OrgMx.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"d-flex align-center mb-4"},ee={class:"main-container"},ae={class:"list-container"},te={class:"form-wrapper"},le={class:"add"},oe={__name:"MasterProcess",setup(se){var E;const r=H.useToast(),R=J(),N=L,P=new Date().toISOString().split("T")[0],a=n({prcCode:"",prcName:"",writer:((E=R.user)==null?void 0:E.name)||"",date:P,type:"",note:""}),m=n([]),T=n([{checkboxSelection:!0,width:50},{field:"공정코드",editable:!0,width:140},{field:"공정명",width:140,editable:!0},{field:"설비유형",width:140,editable:!0},{field:"작성자",width:130,editable:!0},{field:"등록일자",width:130,editable:!0},{field:"비고",width:130,editable:!0}]),x=n({title:"공정 관리"}),A=Y([{title:"기준정보",disabled:!0,href:"#"},{title:"공정 관리",disabled:!1,href:"#"}]),p=async()=>{const t=await c.get("http://localhost:3000/masterPrcSelect");console.log(t),m.value=t.data.map(e=>({공정코드:e.PRC_CODE,공정명:e.PRC_NAME,설비유형:e.FAC_TYPE,작성자:e.PRC_WRITER,등록일자:e.PRC_RDATE?e.PRC_RDATE.substring(0,10):null,비고:e.PRC_NOTE}))};z(()=>{p(),U()});const k=async()=>{try{const t=m.value.some(e=>e.공정명===a.value.prcName);if(!a.value.prcCode&&t){r.warning("이미 등록된 공정명입니다.",{position:"top-right",duration:1e3});return}if(!a.value.type||!a.value.prcName){r.warning("공정명과 설비유형을 입력해주세요.",{position:"top-right",duration:1e3});return}if(a.value.prcCode){const e={PRC_NAME:a.value.prcName,PRC_TYPE:a.value.type,PRC_WRITER:a.value.writer,PRC_DATE:a.value.date,PRC_NOTE:a.value.note,PRC_CODE:a.value.prcCode};await c.post("http://localhost:3000/masterPrcUpdate",e),r.success("공정이 수정되었습니다.",{position:"top-right",duration:1e3}),await p()}else{const e={PRC_NAME:a.value.prcName,FAC_TYPE:a.value.type,PRC_WRITER:a.value.writer,PRC_RDATE:a.value.date,PRC_NOTE:a.value.note};await c.post("http://localhost:3000/masterPrcInsert",e),r.success("공정이 등록되었습니다.",{position:"top-right",duration:1e3}),await p()}}catch(t){console.error(t),r.error("저장 중 오류가 발생했습니다.",{position:"top-right",duration:1e3})}},M=async()=>{if(!a.value.prcCode){r.warning("삭제할 공정을 선택하세요.",{position:"top-right",duration:1e3});return}try{await c.post("http://localhost:3000/masterPrcDelete",{PRC_CODE:a.value.prcCode}),r.success(`${a.value.prcName}(이)가 삭제되었습니다.`,{position:"top-right",duration:1e3}),g()}catch{r.error("삭제 중 오류가 발생했습니다.",{position:"top-right",duration:1e3})}},f=n(""),O=async()=>{if(!f.value){r.warning("공정이 입력되지 않았습니다",{position:"top-right",duration:1e3});return}const t={PRC_NAME:f.value},e=await c.post("http://localhost:3000/masterPrcSearch",t);m.value=e.data.map(o=>({공정코드:o.PRC_CODE,공정명:o.PRC_NAME,설비유형:o.FAC_TYPE,작성자:o.PRC_WRITER,등록일자:o.PRC_RDATE?o.PRC_RDATE.substring(0,10):null,비고:o.PRC_NOTE})),r.success("검색이 완료되었습니다.",{position:"top-right",duration:1e3})},g=()=>{var t;a.value.prcCode="",a.value.prcName="",a.value.date=P,a.value.note="",a.value.type="",a.value.writer=((t=R.user)==null?void 0:t.name)||"",p()},F=t=>{a.value.prcCode=t.data.공정코드,a.value.prcName=t.data.공정명,a.value.writer=t.data.작성자,a.value.date=t.data.등록일자,a.value.type=t.data.설비유형,a.value.note=t.data.비고},_=n(null),h=n(""),y=n([]),V=n([]),S=[{field:"그룹코드",headerName:"그룹코드",flex:1},{field:"설비유형",headerName:"설비유형",flex:1},{field:"사용유무",headerName:"사용유무",flex:1}],b=n([]),U=async()=>{const t=await c.get("http://localhost:3000/masterPrcModal");b.value=t.data.map(e=>({그룹코드:e.group_code,설비유형:e.code_name,사용유무:e.use_yn})),console.log(t)},I=async(t,e,o)=>{h.value=t,y.value=e,V.value=o,_.value&&_.value.open()},$=async t=>{a.value.type=t.설비유형};return(t,e)=>(q(),j(K,null,[l(B,{title:x.value.title,breadcrumbs:A.value},null,8,["title","breadcrumbs"]),l(W,{title:"공정 목록"},{default:s(()=>[u("div",Z,[l(i,{label:"공정 검색",modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),"hide-details":"",class:"mr-2",style:{"max-width":"280px"}},null,8,["modelValue"]),l(v,{color:"darkText",onClick:O},{default:s(()=>e[8]||(e[8]=[C("검색")])),_:1}),l(w,{justify:"end",class:"mr-3"},{default:s(()=>[l(v,{color:"error",class:"mr-1",onClick:M},{default:s(()=>e[9]||(e[9]=[C("삭제")])),_:1})]),_:1})]),u("div",ee,[u("div",ae,[l(D(Q),{rowData:m.value,columnDefs:T.value,theme:D(N),style:{height:"500px",width:"100%"},onCellValueChanged:t.onCellValueChanged,onRowClicked:F,rowSelection:"single"},null,8,["rowData","columnDefs","theme","onCellValueChanged"])]),u("div",te,[u("div",le,[l(w,{class:"mb-4"},{default:s(()=>[l(d,{cols:"6"},{default:s(()=>[l(i,{label:"공정코드",modelValue:a.value.prcCode,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.prcCode=o),readonly:"true",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),l(d,{cols:"6"},{default:s(()=>[l(i,{label:"공정명",modelValue:a.value.prcName,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.prcName=o),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),l(d,{cols:"6"},{default:s(()=>[l(i,{label:"작성자",modelValue:a.value.writer,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.writer=o),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),l(d,{cols:"6"},{default:s(()=>[l(i,{label:"등록일자",modelValue:a.value.date,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.date=o),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),l(d,{cols:"6"},{default:s(()=>[l(i,{label:"설비유형",modelValue:a.value.type,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.type=o),dense:"",outlined:"",readonly:""},{"append-inner":s(()=>[u("i",{class:"fa-solid fa-magnifying-glass",style:{cursor:"pointer","font-size":"large","margin-right":"0.5rem"},onClick:e[5]||(e[5]=o=>I("설비 조회",b.value,S))})]),_:1},8,["modelValue"]),l(G,{ref_key:"modalRef",ref:_,title:h.value,rowData:y.value,colDefs:V.value,onConfirm:$},null,8,["title","rowData","colDefs"])]),_:1}),l(d,{cols:"4"}),l(d,{cols:"12"},{default:s(()=>[l(i,{label:"비고",modelValue:a.value.note,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.note=o),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),l(w,{justify:"center"},{default:s(()=>[l(v,{color:"error",class:"mr-3",onClick:g},{default:s(()=>e[10]||(e[10]=[C("초기화")])),_:1}),l(v,{color:"primary",class:"mr-6",onClick:k},{default:s(()=>e[11]||(e[11]=[C("저장")])),_:1})]),_:1})]),_:1})]),e[12]||(e[12]=u("br",null,null,-1))])])]),_:1})],64))}},pe=X(oe,[["__scopeId","data-v-bd89d42a"]]);export{pe as default};
