import{_ as O,a as S}from"./UiParentCard.vue_vue_type_script_setup_true_lang-DnD-5gIF.js";import{B as I}from"./main-Dfa23GB-.js";import{O as s,a6 as P,P as U,q as k,o as $,a as l,w as r,f as m,e as p,V as h,b as i,a0 as u,A as x,a1 as B,F,$ as C}from"./index-CGGVM91c.js";import{_ as G}from"./NewModal-RG6-e5WE.js";import{u as Y}from"./auth-B63OrgMx.js";import{d as q}from"./theme-bootstrap-maRaUoWN.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const L={__name:"MaterialOrderInsert",setup(Q){var v;const d=q.useToast(),c=Y(),y=B,n=s([]),T=s([{field:"자재명",flex:1},{field:"자재코드",flex:1},{field:"자재유형",flex:1},{field:"규격",flex:1},{field:"단위",flex:1},{field:"수량",editable:!0,flex:1}]),a=P({supplier:"",orderDate:new Date().toISOString().substring(0,10),dueDate:"",manager:((v=c.user)==null?void 0:v.name)||""}),f=s(null),D=s(""),g=s([]),_=s([]),V=[{field:"자재코드",headerName:"자재코드",flex:1},{field:"자재명",headerName:"자재명",flex:1},{field:"자재유형",headerName:"자재유형",flex:1},{field:"규격",headerName:"규격",flex:1},{field:"단위",headerName:"단위",flex:1}],A=s([]),E=async o=>{D.value=o,_.value=V;try{const e=await C.get("http://localhost:3000/materials");g.value=e.data.map(t=>({자재코드:t.MAT_CODE,자재명:t.MAT_NAME,자재유형:t.MAT_TYPE,규격:t.MAT_SIZE,단위:t.MAT_UNIT})),f.value&&f.value.open()}catch(e){console.error("자재 목록을 가져오는 중 오류가 발생했습니다:"+e),alert("자재 목록을 불러오는 데 실패했습니다.")}};function M(o){Array.isArray(o)||(o=[o]),o.forEach(e=>{n.value.push({자재명:e.자재명||"",자재코드:e.자재코드||"",자재유형:e.자재유형||"",규격:e.규격||"",단위:e.단위||""})})}function b(){var o;a.supplier="",a.orderDate=new Date().toISOString().substring(0,10),a.dueDate="",a.manager=((o=c.user)==null?void 0:o.name)||"",n.value=[]}async function w(){try{if(!a.supplier||!a.manager||!a.orderDate||!a.dueDate){d.warning("모든 필드를 입력해주세요.",{position:"top-right",duration:2e3});return}if(n.value.length===0){d.warning("자재를 선택해주세요.",{position:"top-right",duration:2e3});return}const o={SUPPLYER:a.supplier,ORDER_DATE:a.orderDate,PO_DDAY:a.dueDate,MANAGER:a.manager,PO_STATUS:"대기"},e=n.value.map(t=>({MAT_CODE:t.자재코드,RECEIPT_QTY:t.수량||0}));await C.post("http://localhost:3000/material/order/insert",{orderData:o,detailList:e}),d.success("등록 성공",{position:"top-right",duration:1e3}),b()}catch(o){console.error(o),d.error("등록 중 오류가 발생했습니다.",{position:"top-right",duration:2e3})}}const R=s({title:"자재발주서"}),N=U([{title:"자재",disabled:!0,href:"#"},{title:"자재발주서 등록",disabled:!1,href:"#"}]);return(o,e)=>($(),k(F,null,[l(O,{title:R.value.title,breadcrumbs:N.value},null,8,["title","breadcrumbs"]),l(S,{title:"자재발주서 등록"},{default:r(()=>[l(m,{color:"warning",class:"mr-2",onClick:e[0]||(e[0]=t=>E("자재 조회",A.value,V)),style:{"margin-bottom":"2rem"}},{default:r(()=>e[5]||(e[5]=[p(" 자재 조회 ")])),_:1}),l(G,{ref_key:"modalRef",ref:f,title:D.value,rowData:g.value,colDefs:_.value,onConfirm:M},null,8,["title","rowData","colDefs"]),l(h,{class:"mb-4"},{default:r(()=>[l(i,{cols:"6"},{default:r(()=>[l(u,{label:"공급처",modelValue:a.supplier,"onUpdate:modelValue":e[1]||(e[1]=t=>a.supplier=t),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),l(i,{cols:"6"},{default:r(()=>[l(u,{label:"담당자",modelValue:a.manager,"onUpdate:modelValue":e[2]||(e[2]=t=>a.manager=t),outlined:"",readonly:""},null,8,["modelValue"])]),_:1}),l(i,{cols:"6"},{default:r(()=>[l(u,{label:"발주일자",modelValue:a.orderDate,"onUpdate:modelValue":e[3]||(e[3]=t=>a.orderDate=t),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),l(i,{cols:"6"},{default:r(()=>[l(u,{label:"납기일자",modelValue:a.dueDate,"onUpdate:modelValue":e[4]||(e[4]=t=>a.dueDate=t),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),l(x(I),{rowData:n.value,columnDefs:T.value,theme:x(y),style:{height:"200px",width:"100%"},onCellValueChanged:o.onCellValueChanged,onGridReady:o.onGridReady},null,8,["rowData","columnDefs","theme","onCellValueChanged","onGridReady"]),l(h,{justify:"end",class:"button"},{default:r(()=>[l(m,{color:"error",class:"mr-2",onClick:b},{default:r(()=>e[6]||(e[6]=[p("초기화")])),_:1}),l(m,{color:"primary",onClick:w},{default:r(()=>e[7]||(e[7]=[p("등록")])),_:1})]),_:1})]),_:1})],64))}},ee=z(L,[["__scopeId","data-v-45bccdf1"]]);export{ee as default};
